# ============================================
# OSG èŒä¸šåŸ¹è®­å¹³å° - é¡¹ç›®é…ç½®
# ============================================

# é¡¹ç›®åŸºæœ¬ä¿¡æ¯
name: "osg-platform"
type: fullstack
description: "é‡‘èè¡Œä¸šæ±‚èŒåŸ¹è®­ B2C å¹³å°"

# æŠ€æœ¯æ ˆ
tech_stack:
  backend:
    language: java
    runtime: "Java 21"
    framework: spring-boot
    version: "3.x"
    orm: mybatis
  frontend:
    language: typescript
    framework: vue
    version: "3.x"
    ui: ant-design-vue
    state: pinia
    package_manager: pnpm
  database:
    type: mysql
    version: "8.0"
  cache:
    type: redis

# å‘½ä»¤æ˜ å°„
commands:
  # åç«¯å‘½ä»¤
  test: "mvn test"
  test-single: "mvn test -Dtest={class}"
  build: "mvn -DskipTests package"
  lint: "mvn checkstyle:check"
  run: "mvn -pl ruoyi-admin -am spring-boot:run"
  
  # å‰ç«¯å‘½ä»¤ï¼ˆpnpm workspace å­åŒ…ç›´æ¥è°ƒç”¨ï¼‰
  frontend:
    install: "cd osg-frontend && pnpm install"
    build: "pnpm --dir osg-frontend/packages/admin build"
    build-all: "cd osg-frontend && pnpm build:all"
    lint: "cd osg-frontend && pnpm lint"
    test: "pnpm --dir osg-frontend/packages/admin test"
    dev: "pnpm --dir osg-frontend/packages/admin dev"
    dev-student: "pnpm --dir osg-frontend/packages/student dev"
    dev-mentor: "pnpm --dir osg-frontend/packages/mentor dev"
    dev-lead-mentor: "pnpm --dir osg-frontend/packages/lead-mentor dev"
    dev-assistant: "pnpm --dir osg-frontend/packages/assistant dev"
    dev-admin: "pnpm --dir osg-frontend/packages/admin dev"
  
  # è¿ç»´å‘½ä»¤
  ops:
    docker_build: "docker-compose build"
    docker_run: "docker-compose up -d"
    logs: "docker-compose logs -f"
    health: "curl -s http://localhost:8080/actuator/health"

# ç›®å½•çº¦å®š
paths:
  backend:
    source: "ruoyi-*/src/main/java/"
    tests: "ruoyi-*/src/test/java/"
    controllers: "ruoyi-admin/src/main/java/**/controller/"
    services: "ruoyi-system/src/main/java/**/service/"
    mappers: "ruoyi-system/src/main/java/**/mapper/"
  frontend:
    source: "osg-frontend/packages/"
    admin: "osg-frontend/packages/admin/"              # ç®¡ç†åå°ï¼ˆVue 3 + Ant Design Vueï¼‰
    admin_legacy: "ruoyi-ui/"                           # è‹¥ä¾å‰ç«¯ï¼ˆä¿ç•™åšè¿ç»´ï¼‰
    components: "osg-frontend/packages/shared/src/components/"
    pages: "osg-frontend/packages/*/src/views/"
    api: "osg-frontend/packages/shared/src/api/"
    types: "osg-frontend/packages/shared/src/types/"
  docs:
    spec: "osg-spec-docs/docs/"
    source: "osg-spec-docs/source/"                     # åŸå§‹æ–‡æ¡£ï¼ˆmd/docx ä»…ä½œå‚è€ƒï¼Œä¸ä½œä¸ºéœ€æ±‚æ¥æºï¼‰
    prototypes: "osg-spec-docs/source/prototype/"       # UI åŸå‹ HTMLï¼ˆSSOT å”¯ä¸€çœŸå®æ¥æºï¼‰
    prd: "osg-spec-docs/docs/01-product/prd/"           # PRD æ–‡æ¡£ï¼ˆä» HTML åŸå‹ç”Ÿæˆï¼ŒæŒ‰æ¨¡å—å­ç›®å½•ï¼‰
    api: "osg-spec-docs/docs/06-api/"
    database: "osg-spec-docs/docs/07-database/"
    requirements: "osg-spec-docs/docs/02-requirements/"
    srs: "osg-spec-docs/docs/02-requirements/srs/"
  tasks:
    root: "osg-spec-docs/tasks/"
    state: "osg-spec-docs/tasks/STATE.yaml"
    stories: "osg-spec-docs/tasks/stories/"
    tickets: "osg-spec-docs/tasks/tickets/"
    test_matrices: "osg-spec-docs/tasks/test-matrices/"

# ============================================
# PRD ç”Ÿæˆæµç¨‹ï¼ˆIEEE 830 + BABOK è¡Œä¸šæ ‡å‡†ï¼‰
# ============================================
prd_process:
  # å”¯ä¸€çœŸå®æ¥æºï¼ˆSingle Source of Truthï¼‰
  ssot: "HTML åŸå‹æ–‡ä»¶ï¼ˆ${paths.docs.prototypes}ï¼‰"
  
  # éœ€æ±‚å·¥ç¨‹æµæ°´çº¿
  # HTML åŸå‹ â†’ PRDï¼ˆé¡µé¢çº§ï¼‰â†’ SRSï¼ˆIEEE 830ï¼‰â†’ Stories â†’ Tickets
  pipeline:
    - step: "PRD ç”Ÿæˆ"
      input: "${paths.docs.prototypes}/*.html"
      output: "${paths.docs.prd}/{module}/"
      format: "é¡µé¢çº§ PRDï¼ˆå­—æ®µå®šä¹‰ã€äº¤äº’è§„åˆ™ã€ä¸šåŠ¡è§„åˆ™ã€å†³ç­–è®°å½•ï¼‰"
      trigger: "/brainstorm è‡ªåŠ¨æ£€æµ‹å¹¶ç”Ÿæˆ"
    - step: "SRS ç”Ÿæˆï¼ˆbrainstorm äº§ç‰©ï¼‰"
      input: "${paths.docs.prd}/{module}/"
      output: "${paths.docs.srs}/{module}.md"
      format: "IEEE 830ï¼ˆFR/NFR/AC/æ¥å£å®šä¹‰/æ•°æ®æ¨¡å‹/PRDæº¯æºï¼‰"
  
  # å¼ºåˆ¶è§„åˆ™
  rules:
    - "HTML åŸå‹æ˜¯å”¯ä¸€çœŸå®æ¥æºï¼Œmd/docx æ–‡æ¡£ä»…ä½œä¸šåŠ¡èƒŒæ™¯å‚è€ƒ"
    - "PRD æŒ‰æ¨¡å—å­ç›®å½•å­˜æ”¾ï¼ˆå¦‚ prd/admin/, prd/career/ï¼‰"
    - "æ¯ä¸ª FR å¿…é¡»æ ‡æ³¨ PRD æ¥æºï¼ˆæ–‡ä»¶å + ç« èŠ‚å·ï¼‰"
    - "SRS å¿…é¡»åŒ…å«æ¥å£å®šä¹‰ï¼ˆå·²æœ‰æ¥å£ + æ–°å¢æ¥å£ï¼‰å’Œæ•°æ®åº“å˜æ›´"
    - "PRD ä¸å­˜åœ¨æ—¶ï¼Œbrainstorm æµç¨‹è‡ªåŠ¨ä» HTML åŸå‹ç”Ÿæˆ PRD"
  
  # åŸå‹åˆ°æ¨¡å—çš„æ˜ å°„ï¼ˆæŒ‰ä¸šåŠ¡åŠŸèƒ½åˆ’åˆ†ï¼Œæ¯ä¸ªæ¨¡å—ç‹¬ç«‹ç›®å½•ï¼‰
  module_prototype_map:
    permission: ["admin.html"]              # æƒé™ç®¡ç†ï¼ˆhome + roles + admins + base-dataï¼‰
    user-center: ["admin.html"]             # ç”¨æˆ·ä¸­å¿ƒï¼ˆstudents + contracts + staff + mentor-scheduleï¼‰
    teaching: ["admin.html"]                # æ•™å­¦ä¸­å¿ƒï¼ˆclass-records + communicationï¼‰
    finance: ["admin.html"]                 # è´¢åŠ¡ä¸­å¿ƒï¼ˆfinance + expenseï¼‰
    resource: ["admin.html"]                # èµ„æºä¸­å¿ƒï¼ˆfiles + test-bank + interview-bank + questionsï¼‰
    notification: ["admin.html"]            # ä¸ªäººä¸­å¿ƒ/ç³»ç»Ÿï¼ˆmailjob + notice + complaints + logsï¼‰
    career: ["index.html", "lead-mentor.html", "assistant.html", "admin.html"]  # æ±‚èŒä¸­å¿ƒï¼ˆè·¨ç«¯ï¼‰
    student: ["index.html", "PRD_Student.html"]
    mentor: ["mentor.html", "PRD_Mentor.html"]

# å¯ç”¨çš„å¼€å‘è€…è§’è‰²
developers:
  - backend-java
  - frontend-vue
  - frontend-admin    # ç®¡ç†åå°å‰ç«¯ï¼ˆUI è¿˜åŸ + åŠŸèƒ½å®ç°ï¼‰
  - dba-mysql

# ä¸šåŠ¡è§’è‰²
roles:
  - student      # å­¦ç”Ÿ
  - mentor       # å¯¼å¸ˆ
  - lead-mentor  # ç­ä¸»ä»»
  - assistant    # åŠ©æ•™
  - admin        # ç®¡ç†å‘˜

# å‰ç«¯ç«¯å£é…ç½®
ports:
  student: 3001
  mentor: 3002
  lead-mentor: 3003
  assistant: 3004
  admin: 3005          # ç®¡ç†åå°ï¼ˆosg-frontend/packages/adminï¼‰
  admin_legacy: 8080   # è‹¥ä¾ç®¡ç†åå°ï¼ˆruoyi-uiï¼Œä¿ç•™åšè¿ç»´ï¼‰

# å®¡æ‰¹é…ç½®
approval:
  brainstorm_confirm: required # éœ€æ±‚ç¡®è®¤å¿…é¡»äººå·¥å®¡æ‰¹
  story_split: required      # Story æ‹†åˆ†åéœ€è¦å®¡æ‰¹
  ticket_split: auto         # Ticket æ‹†åˆ†åè‡ªåŠ¨ç»§ç»­
  ticket_done: auto          # Ticket å®Œæˆåè‡ªåŠ¨ç»§ç»­
  story_done: auto           # Story å®Œæˆåè‡ªåŠ¨ç»§ç»­ä¸‹ä¸€ä¸ª

# è‡ªåŠ¨æ‰§è¡Œé™åˆ¶
limits:
  max_iterations: 20         # æœ€å¤§è¿­ä»£æ¬¡æ•°
  max_retries: 3             # æœ€å¤§é‡è¯•æ¬¡æ•°
  ticket_timeout: 30         # Ticket è¶…æ—¶ï¼ˆåˆ†é’Ÿï¼‰

# ============================================
# ğŸš¨ æµ‹è¯•é…ç½®ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰
# ============================================
testing:
  # è¦†ç›–ç‡é—¨æ§›
  coverage:
    enabled: true
    # åç«¯/æ•°æ®åº“/æµ‹è¯•ç±»å‹
    backend:
      branch: 100            # åˆ†æ”¯è¦†ç›–ç‡å¿…é¡» 100%
      line: 90               # è¡Œè¦†ç›–ç‡ â‰¥ 90%
      method: 90             # æ–¹æ³•è¦†ç›–ç‡ â‰¥ 90%
    # å‰ç«¯åŠŸèƒ½ç±»å‹ï¼ˆsoft: ä»…å‘Šè­¦ä¸é˜»å¡ï¼Œå¾…æµ‹è¯•è¦†ç›–ä¸šåŠ¡ä»£ç åæ”¹ä¸º hardï¼‰
    frontend:
      branch: 90             # åˆ†æ”¯è¦†ç›–ç‡ â‰¥ 90%
      line: 80               # è¡Œè¦†ç›–ç‡ â‰¥ 80%
      enforcement: soft      # soft=å‘Šè­¦ | hard=é˜»å¡
    # å‰ç«¯ UI è¿˜åŸç±»å‹ï¼ˆsoft: ä»…å‘Šè­¦ä¸é˜»å¡ï¼‰
    frontend_ui:
      branch: 80             # åˆ†æ”¯è¦†ç›–ç‡ â‰¥ 80%
      line: 70               # è¡Œè¦†ç›–ç‡ â‰¥ 70%
      enforcement: soft      # soft=å‘Šè­¦ | hard=é˜»å¡

  # æµ‹è¯•å‘½ä»¤
  commands:
    backend:
      test: "mvn test"
      test_single: "mvn test -Dtest={TestClass}"
      test_coverage: "mvn test jacoco:report"
      coverage_check: "mvn jacoco:check"
      coverage_report: "target/site/jacoco"
    frontend:
      test: "pnpm --dir osg-frontend/packages/admin test"
      test_single: "pnpm --dir osg-frontend/packages/admin test {testFile}"
      test_coverage: "pnpm --dir osg-frontend/packages/admin test --coverage"
      coverage_report: "osg-frontend/packages/admin/coverage"

  # é›†æˆæµ‹è¯•
  integration:
    enabled: true
    command: "mvn verify -Pintegration-test"
    timeout: 600             # 10 åˆ†é’Ÿ

  # æµ‹è¯•ç”¨ä¾‹è®¾è®¡è¦æ±‚
  design:
    # å¿…é¡»åº”ç”¨çš„è®¾è®¡æ–¹æ³•
    required_methods:
      - equivalence_partitioning    # ç­‰ä»·ç±»åˆ’åˆ†
      - boundary_value_analysis     # è¾¹ç•Œå€¼åˆ†æ
      - decision_table              # å†³ç­–è¡¨æµ‹è¯•
    # å¯é€‰çš„è®¾è®¡æ–¹æ³•
    optional_methods:
      - state_transition            # çŠ¶æ€è½¬æ¢æµ‹è¯•
      - cause_effect                # å› æœå›¾æ³•
    # å¿…é¡»è¦†ç›–çš„æµ‹è¯•ç±»å‹
    required_test_types:
      - positive                    # æ­£å‘æµ‹è¯•
      - negative                    # è´Ÿå‘æµ‹è¯•
      - boundary                    # è¾¹ç•Œæµ‹è¯•
      - exception                   # å¼‚å¸¸æµ‹è¯•
      - null_empty                  # null/ç©ºå€¼æµ‹è¯•

  # API æµ‹è¯•ç»´åº¦
  api_test_dimensions:
    - happy_path                    # æ­£å‘æµ‹è¯•
    - negative                      # è´Ÿå‘æµ‹è¯•
    - boundary                      # è¾¹ç•Œæµ‹è¯•
    - security                      # å®‰å…¨æµ‹è¯•
    - performance                   # æ€§èƒ½æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

  # E2E æµ‹è¯•ï¼ˆPlaywrightï¼‰
  e2e:
    enabled: true
    framework: playwright
    command: "pnpm --dir osg-frontend test:e2e"
    report: "osg-frontend/playwright-report"
    trigger: "manual"              # manual = æ‰‹åŠ¨è§¦å‘, auto = all_stories_done æ—¶è‡ªåŠ¨
