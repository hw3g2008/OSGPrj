# å®ç°ç»†èŠ‚

æœ¬æ–‡æ¡£è¯´æ˜æ¡†æ¶ä¸­ä¸€äº›æŠ€æœ¯å®ç°çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬ Subagent è°ƒç”¨ã€ä¸Šä¸‹æ–‡æ£€æµ‹ã€Git é›†æˆç­‰ã€‚

---

## 1. Subagent è°ƒç”¨å®ç°

### é—®é¢˜èƒŒæ™¯

æ¡†æ¶è®¾è®¡ä¸­ä½¿ç”¨äº† `Task(agent="xxx", prompt="xxx")` è¯­æ³•æ¥è°ƒç”¨ Subagentï¼Œä½† Cursor ç›®å‰**ä¸åŸç”Ÿæ”¯æŒ**è¿™ç§è°ƒç”¨æ–¹å¼ã€‚

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šåŸºäº Prompt çš„æ¨¡æ‹Ÿå®ç°ï¼ˆæ¨èï¼‰

åœ¨å½“å‰ä¼šè¯ä¸­é€šè¿‡ Prompt åˆ‡æ¢è§’è‰²ï¼Œè€ŒéçœŸæ­£è°ƒç”¨ç‹¬ç«‹çš„ Agentã€‚

```markdown
# å®ç°æ–¹å¼

å½“éœ€è¦è°ƒç”¨æŸä¸ª Agent æ—¶ï¼Œåœ¨ Prompt ä¸­å£°æ˜è§’è‰²åˆ‡æ¢ï¼š

"""
## ğŸ”„ è§’è‰²åˆ‡æ¢

**åˆ‡æ¢åˆ°**: backend-java Agent
**ä»»åŠ¡**: æ‰§è¡Œ Ticket T-003

---

### åŠ è½½é…ç½®
- Agent: .claude/project/agents/backend-java.md
- Skills: deliver-ticket, tdd, checkpoint-manager
- Rules: java.md

### ç³»ç»Ÿæç¤ºè¯
{åŠ è½½ backend-java.md çš„å†…å®¹}

---

å¼€å§‹æ‰§è¡Œä»»åŠ¡...
"""
```

**ä¼˜ç‚¹**ï¼š
- æ— éœ€é¢å¤–å·¥å…·
- åœ¨å½“å‰ Cursor ä¸­å³å¯ä½¿ç”¨
- ä¿æŒä¸Šä¸‹æ–‡è¿ç»­æ€§

**ç¼ºç‚¹**ï¼š
- è§’è‰²åˆ‡æ¢é  Prompt çº¦æŸï¼Œå¯èƒ½ä¸å¤Ÿä¸¥æ ¼
- æ— æ³•çœŸæ­£å¹¶è¡Œæ‰§è¡Œ

#### æ–¹æ¡ˆ Bï¼šä½¿ç”¨ Claude Code CLIï¼ˆæœªæ¥ï¼‰

å¦‚æœä½¿ç”¨ Claude Code CLIï¼Œå¯ä»¥çœŸæ­£è°ƒç”¨ Subagentï¼š

```bash
# Claude Code å®˜æ–¹ subagent è¯­æ³•
claude --agent backend-java --prompt "æ‰§è¡Œ Ticket T-003"
```

#### æ–¹æ¡ˆ Cï¼šä½¿ç”¨ MCP å·¥å…·ï¼ˆé«˜çº§ï¼‰

é€šè¿‡ MCP (Model Context Protocol) å®ç°çœŸæ­£çš„ Agent åˆ†æ´¾ï¼š

```typescript
// MCP Server ç¤ºä¾‹
const dispatchAgent = async (agentName: string, prompt: string) => {
  const agentConfig = loadAgent(agentName);
  const skills = loadSkills(agentConfig.skills);
  
  return await claude.chat({
    system: agentConfig.systemPrompt + skills.join('\n'),
    messages: [{ role: 'user', content: prompt }]
  });
};
```

### å½“å‰æ¨èå®ç°

åœ¨ Cursor ä¸­ä½¿ç”¨**æ–¹æ¡ˆ A**ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æ¨¡æ‹Ÿ Agent è°ƒç”¨ï¼š

```markdown
# /next å‘½ä»¤çš„å®é™…æ‰§è¡Œæ­¥éª¤ï¼ˆç²¾ç¡®åˆ°æ“ä½œï¼‰

## Step 1: è¯»å–çŠ¶æ€
1. æ‰§è¡Œ: `è¯»å– ${config.paths.tasks.state}`
2. è·å–: `current.ticket` å­—æ®µå€¼
3. å¦‚æœä¸º null: 
   - æ‰«æ `stories` ä¸­ç¬¬ä¸€ä¸ª `status: in_progress` çš„ Story
   - è·å–è¯¥ Story çš„ tickets åˆ—è¡¨
   - æ‰¾ç¬¬ä¸€ä¸ª `status: pending` çš„ Ticket ID

## Step 2: è¯»å– Ticket å®šä¹‰
1. æ‰§è¡Œ: `è¯»å– ${config.paths.tasks.tickets}{Ticket_ID}.yaml`
2. è·å–: `type` å­—æ®µï¼ˆbackend | frontend | frontend-ui | databaseï¼‰

## Step 3: ç¡®å®š Agent
1. ä¼˜å…ˆä½¿ç”¨ Ticket YAML ä¸­çš„ `agent` å­—æ®µï¼ˆå¦‚æœé nullï¼‰
2. å¦‚æœ `agent` ä¸º nullï¼Œåˆ™æ ¹æ® `type` å­—æ®µæ˜ å°„åˆ° `config.yaml` çš„ `developers` åˆ—è¡¨ä¸­åŒ¹é…çš„ Agentï¼š
   - backend â†’ `developers` ä¸­ä»¥ `backend-` å¼€å¤´çš„ Agent
   - frontend â†’ `developers` ä¸­ä»¥ `frontend-vue` æˆ– `frontend-` å¼€å¤´çš„ Agentï¼ˆæ’é™¤ UI ä¸“ç”¨ï¼‰
   - frontend-ui â†’ `developers` ä¸­åä¸º `frontend-admin` æˆ–åŒ…å« `ui` çš„ Agent
   - database â†’ `developers` ä¸­ä»¥ `dba-` å¼€å¤´çš„ Agent
3. è¯»å–å¯¹åº”çš„ `.claude/project/agents/{agent-name}.md`
2. è¯»å– Agent æ–‡ä»¶ä¸­çš„:
   - `skills:` å­—æ®µ â†’ ç¡®å®šè¦åŠ è½½çš„ Skills
   - `rules:` å­—æ®µ â†’ ç¡®å®šè¦åŠ è½½çš„ä»£ç è§„èŒƒ

## Step 4: åŠ è½½ Skillsï¼ˆç²¾ç¡®æ­¥éª¤ï¼‰

```python
def åŠ è½½Skills(skillåç§°åˆ—è¡¨: list[str]) -> list[dict]:
    """
    åŠ è½½æŒ‡å®šçš„ Skills
    è¿”å›ï¼šSkill å†…å®¹åˆ—è¡¨
    """
    skills = []
    
    for skillåç§° in skillåç§°åˆ—è¡¨:
        # 1. ç¡®å®š Skill æ–‡ä»¶è·¯å¾„
        skillè·¯å¾„ = f".claude/skills/{skillåç§°}/SKILL.md"
        
        # 2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if not æ–‡ä»¶å­˜åœ¨(skillè·¯å¾„):
            è¾“å‡ºè­¦å‘Š(f"âš ï¸ Skill æ–‡ä»¶ä¸å­˜åœ¨: {skillè·¯å¾„}")
            continue
        
        # 3. è¯»å– Skill æ–‡ä»¶
        skillå†…å®¹ = è¯»å–æ–‡ä»¶(skillè·¯å¾„)
        
        # 4. è§£æ YAML frontmatter
        frontmatter = è§£æyamlå¤´(skillå†…å®¹)
        # frontmatter ç¤ºä¾‹:
        # {
        #   "name": "deliver-ticket",
        #   "description": "Use when executing a Ticket...",
        #   "metadata": {
        #     "invoked-by": "agent",
        #     "auto-execute": "true"
        #   }
        # }
        
        # 5. æå–æ­£æ–‡å†…å®¹ï¼ˆfrontmatter ä¹‹åçš„éƒ¨åˆ†ï¼‰
        æ­£æ–‡ = æå–æ­£æ–‡(skillå†…å®¹)
        
        skills.append({
            "name": skillåç§°,
            "frontmatter": frontmatter,
            "content": æ­£æ–‡
        })
        
        è¾“å‡º(f"âœ… åŠ è½½ Skill: {skillåç§°}")
    
    return skills

def è§£æyamlå¤´(æ–‡ä»¶å†…å®¹: str) -> dict:
    """
    è§£æ Markdown æ–‡ä»¶å¼€å¤´çš„ YAML frontmatter
    æ ¼å¼ï¼šæ–‡ä»¶ä»¥ --- å¼€å¤´ï¼Œ--- ç»“å°¾åŒ…è£¹ YAML
    """
    if not æ–‡ä»¶å†…å®¹.startswith("---"):
        return {}
    
    # æ‰¾åˆ°ç¬¬äºŒä¸ª ---
    ç¬¬ä¸€ä¸ªåˆ†éš” = æ–‡ä»¶å†…å®¹.find("---")
    ç¬¬äºŒä¸ªåˆ†éš” = æ–‡ä»¶å†…å®¹.find("---", ç¬¬ä¸€ä¸ªåˆ†éš” + 3)
    
    if ç¬¬äºŒä¸ªåˆ†éš” == -1:
        return {}
    
    yamléƒ¨åˆ† = æ–‡ä»¶å†…å®¹[ç¬¬ä¸€ä¸ªåˆ†éš” + 3:ç¬¬äºŒä¸ªåˆ†éš”].strip()
    return è§£æyaml(yamléƒ¨åˆ†)

def æå–æ­£æ–‡(æ–‡ä»¶å†…å®¹: str) -> str:
    """
    æå– frontmatter ä¹‹åçš„æ­£æ–‡å†…å®¹
    """
    if not æ–‡ä»¶å†…å®¹.startswith("---"):
        return æ–‡ä»¶å†…å®¹
    
    ç¬¬äºŒä¸ªåˆ†éš” = æ–‡ä»¶å†…å®¹.find("---", 3)
    if ç¬¬äºŒä¸ªåˆ†éš” == -1:
        return æ–‡ä»¶å†…å®¹
    
    return æ–‡ä»¶å†…å®¹[ç¬¬äºŒä¸ªåˆ†éš” + 3:].strip()
```

**åŠ è½½é¡ºåº**ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š
1. `deliver-ticket` â†’ `.claude/skills/deliver-ticket/SKILL.md`
2. `tdd` â†’ `.claude/skills/tdd/SKILL.md`
3. `checkpoint-manager` â†’ `.claude/skills/checkpoint-manager/SKILL.md`

**è¾“å‡ºæ ¼å¼**ï¼š
```markdown
## ğŸ“¦ Skills åŠ è½½

| Skill | è·¯å¾„ | çŠ¶æ€ |
|-------|------|------|
| deliver-ticket | .claude/skills/deliver-ticket/SKILL.md | âœ… å·²åŠ è½½ |
| tdd | .claude/skills/tdd/SKILL.md | âœ… å·²åŠ è½½ |
| checkpoint-manager | .claude/skills/checkpoint-manager/SKILL.md | âœ… å·²åŠ è½½ |

**åŠ è½½çš„ Skills å†…å®¹æ‘˜è¦**:
- deliver-ticket: æ‰§è¡Œ Ticketï¼Œä¸¥æ ¼éµå¾ª allowed_paths çº¦æŸ
- tdd: TDD å¼€å‘ï¼Œçº¢-ç»¿-é‡æ„å¾ªç¯
- checkpoint-manager: ä¿å­˜/æ¢å¤ä»»åŠ¡çŠ¶æ€
```

## Step 5: æ‰§è¡Œè§’è‰²åˆ‡æ¢
åœ¨å“åº”ä¸­å£°æ˜è§’è‰²åˆ‡æ¢ï¼Œç„¶åæŒ‰ Skill å®šä¹‰çš„æµç¨‹æ‰§è¡Œã€‚

## ç¤ºä¾‹æ‰§è¡Œæµç¨‹

ç”¨æˆ·: /next

AI å“åº”:
"""
## ğŸ”„ ä»»åŠ¡åˆ†æ´¾

**ä¸‹ä¸€ä¸ª Ticket**: T-003 - ç”¨æˆ·ç¼–è¾‘ API
**ç±»å‹**: backend
**åˆ†æ´¾ç»™**: backend-java

---

## ğŸ“‹ [backend-java Agent] ä»»åŠ¡ç†è§£

**Ticket**: T-003 - ç”¨æˆ·ç¼–è¾‘ API
...
"""
```

### âš ï¸ å…³é”®å®ç°çº¦æŸ

**å¿…é¡»**ï¼š
1. æ¯æ¬¡ `/next` å¿…é¡»å…ˆè¯»å– STATE.yamlï¼Œä¸èƒ½å‡­è®°å¿†
2. Agent åˆ‡æ¢é€šè¿‡è¾“å‡ºå£°æ˜ï¼Œä¸æ˜¯çœŸæ­£çš„è¿›ç¨‹åˆ‡æ¢
3. Skills é€šè¿‡è¯»å–æ–‡ä»¶åŠ è½½ï¼Œä¸æ˜¯å†…ç½®çš„
4. æ‰€æœ‰çŠ¶æ€å˜æ›´å¿…é¡»å†™å› YAML æ–‡ä»¶

**ç¦æ­¢**ï¼š
1. âŒ è·³è¿‡è¯»å–çŠ¶æ€æ–‡ä»¶ç›´æ¥æ‰§è¡Œ
2. âŒ å‡è®¾ä¸Šä¸€ä¸ª Ticket çš„çŠ¶æ€
3. âŒ å¿˜è®°æ›´æ–° STATE.yaml

---

## 2. ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡æ£€æµ‹

### é—®é¢˜èƒŒæ™¯

æ¡†æ¶è®¾è®¡ä¸­éœ€è¦æ£€æµ‹ `context_usage` ç™¾åˆ†æ¯”ï¼Œä»¥ä¾¿åœ¨æ¥è¿‘é™åˆ¶æ—¶è§¦å‘å‹ç¼©ã€‚ä½†æˆ‘ä»¬æ— æ³•ç›´æ¥è·å– Claude çš„ token ä½¿ç”¨é‡ã€‚

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šåŸºäºæ–‡ä»¶å¤§å°ä¼°ç®—ï¼ˆæ¨èï¼‰

```python
# ä¼°ç®—ä¸Šä¸‹æ–‡ä½¿ç”¨ç‡
def estimate_context_usage():
    # 1. è®¡ç®—å·²åŠ è½½çš„æ–‡ä»¶æ€»å¤§å°
    loaded_files_size = sum(
        os.path.getsize(f) for f in loaded_files
    )
    
    # 2. ä¼°ç®—å¯¹è¯å†å²å¤§å°
    conversation_size = len(conversation_history) * AVG_CHARS_PER_MESSAGE
    
    # 3. ä¼°ç®—æ€» token æ•°ï¼ˆçº¦ 4 å­—ç¬¦ = 1 tokenï¼‰
    estimated_tokens = (loaded_files_size + conversation_size) / 4
    
    # 4. Claude ä¸Šä¸‹æ–‡çª—å£çº¦ 200K tokens
    MAX_TOKENS = 200000
    
    return (estimated_tokens / MAX_TOKENS) * 100
```

#### æ–¹æ¡ˆ Bï¼šåŸºäºæ¶ˆæ¯è½®æ¬¡ä¼°ç®—

```yaml
# ç®€åŒ–ä¼°ç®—è§„åˆ™
estimation_rules:
  # æ¯è½®å¯¹è¯çº¦æ¶ˆè€— 2000-5000 tokens
  per_round_tokens: 3000
  
  # æ¯ä¸ªåŠ è½½çš„æ–‡ä»¶
  per_file_tokens: 500  # å¹³å‡
  
  # é˜ˆå€¼
  warning_threshold: 70%   # æç¤ºå³å°†å‹ç¼©
  compress_threshold: 85%  # è‡ªåŠ¨è§¦å‘å‹ç¼©
```

#### æ–¹æ¡ˆ Cï¼šåŸºäºè¡Œä¸ºè§‚å¯Ÿ

å½“ Claude å¼€å§‹ï¼š
- å¿˜è®°ä¹‹å‰çš„å¯¹è¯å†…å®¹
- é‡å¤è¯¢é—®å·²å›ç­”çš„é—®é¢˜
- å“åº”å˜æ…¢

è¿™äº›ä¿¡å·è¡¨æ˜ä¸Šä¸‹æ–‡å¯èƒ½æ¥è¿‘é¥±å’Œã€‚

### å½“å‰æ¨èå®ç°

```yaml
# memory/session.yaml ä¸­è®°å½•
context_tracking:
  # è®°å½•åŠ è½½çš„æ–‡ä»¶
  loaded_files:
    - path: "osg-spec-docs/tasks/STATE.yaml"
      size: 2048
      tokens_est: 512
    - path: "osg-spec-docs/tasks/tickets/T-003.yaml"
      size: 4096
      tokens_est: 1024
      
  # è®°å½•å¯¹è¯è½®æ¬¡
  conversation_rounds: 15
  
  # ä¼°ç®—
  estimated_tokens: 50000
  estimated_usage_percent: 25
  
  # è§¦å‘ç‚¹
  last_warning_at: null
  last_compression_at: null
```

---

## 3. æ£€æŸ¥ç‚¹ä¸ Git é›†æˆ

### è‡ªåŠ¨ Git Commit

```yaml
# project/config.yaml ä¸­é…ç½®
git_integration:
  enabled: true
  auto_commit: true
  commit_on:
    - ticket_completed      # Ticket å®Œæˆæ—¶
    - checkpoint_created    # åˆ›å»ºæ£€æŸ¥ç‚¹æ—¶
  
  commit_message_template: |
    [{ticket_id}] {ticket_title}
    
    Story: {story_id}
    Agent: {agent}
    
    Files changed:
    {files_list}
```

### å®ç°é€»è¾‘

```python
def create_checkpoint_with_git(checkpoint_data):
    # 1. åˆ›å»ºæ£€æŸ¥ç‚¹æ–‡ä»¶
    checkpoint_file = f"checkpoints/{checkpoint_data['id']}.yaml"
    save_yaml(checkpoint_file, checkpoint_data)
    
    # 2. Git æ“ä½œ
    if config.git_integration.enabled:
        # æš‚å­˜æ‰€æœ‰å˜æ›´
        run_command("git add -A")
        
        # åˆ›å»º commit
        message = format_commit_message(checkpoint_data)
        run_command(f'git commit -m "{message}"')
        
        # è®°å½• commit hash
        commit_hash = run_command("git rev-parse HEAD")
        checkpoint_data['git']['commit'] = commit_hash
        
        # æ›´æ–°æ£€æŸ¥ç‚¹æ–‡ä»¶
        save_yaml(checkpoint_file, checkpoint_data)
    
    return checkpoint_data
```

### å›æ»šå®ç°

```python
def rollback_to_checkpoint(checkpoint_id):
    # 1. è¯»å–æ£€æŸ¥ç‚¹
    checkpoint = load_yaml(f"checkpoints/{checkpoint_id}.yaml")
    
    # 2. Git reset
    if checkpoint.get('git', {}).get('commit'):
        run_command(f"git reset --hard {checkpoint['git']['commit']}")
    
    # 3. æ¢å¤ STATE.yaml
    state = {
        'phase': checkpoint['state']['phase'],
        'current': {
            'story': checkpoint['state']['story'],
            'ticket': checkpoint['state']['ticket'],
        },
        # ... å…¶ä»–çŠ¶æ€
    }
    save_yaml("osg-spec-docs/tasks/STATE.yaml", state)
    
    return checkpoint
```

---

## 4. å‰ç«¯æµ‹è¯•ç­–ç•¥

### é—®é¢˜èƒŒæ™¯

`frontend-vue` Agent æ²¡æœ‰åŠ è½½ `tdd` skillï¼Œå› ä¸ºå‰ç«¯æµ‹è¯•ç­–ç•¥ä¸åç«¯ä¸åŒã€‚

### å‰ç«¯æµ‹è¯•æ–¹æ¡ˆ

```yaml
# å‰ç«¯æµ‹è¯•ç­–ç•¥
frontend_testing:
  # å•å…ƒæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
  unit_tests:
    enabled: false  # Vue 2 é¡¹ç›®å¯èƒ½æ²¡æœ‰é…ç½®
    tool: "jest"
    command: "npm run test:unit"
    
  # Lint æ£€æŸ¥ï¼ˆå¿…é¡»ï¼‰
  lint:
    enabled: true
    command: "npm run lint"
    auto_fix: true
    
  # æ„å»ºæ£€æŸ¥ï¼ˆå¿…é¡»ï¼‰
  build:
    enabled: true
    command: "npm run build"
    
  # è§†è§‰éªŒè¯ï¼ˆå¯é€‰ï¼‰
  visual:
    enabled: false  # éœ€è¦é…ç½® Storybook æˆ–ç±»ä¼¼å·¥å…·
```

### å‰ç«¯ Ticket éªŒæ”¶æ ‡å‡†

```yaml
# å‰ç«¯ Ticket ç¤ºä¾‹
id: T-005
type: frontend
agent: frontend-vue

acceptance:
  # å¿…é¡»é€šè¿‡ lint
  - type: command
    run: "npm run lint"
    expect: "No ESLint errors"
    
  # å¿…é¡»èƒ½æ„å»º
  - type: command
    run: "npm run build"
    expect: "Build complete"
    
  # å¯é€‰ï¼šæˆªå›¾éªŒè¯
  - type: manual
    description: "é¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼ŒåŠŸèƒ½å¯ç”¨"
```

---

## 4.5 UI è¿˜åŸä»»åŠ¡å¤„ç†

### é—®é¢˜èƒŒæ™¯

å½“é¡¹ç›®ä¸­å­˜åœ¨ HTML/CSS åŸå‹æ–‡ä»¶ï¼ˆè®¾è®¡ç¨¿çš„é™æ€å®ç°ï¼‰æ—¶ï¼Œéœ€è¦å°†è¿™äº›åŸå‹è¿˜åŸä¸ºå®é™…æ¡†æ¶ä»£ç ã€‚UI è¿˜åŸä»»åŠ¡ä¸ä¼ ç»Ÿåç«¯å¼€å‘æœ‰æœ¬è´¨åŒºåˆ«ï¼šæ²¡æœ‰å¯è‡ªåŠ¨åŒ–çš„å•å…ƒæµ‹è¯•ï¼ˆè§†è§‰æ•ˆæœæ— æ³•é€šè¿‡æ–­è¨€éªŒè¯ï¼‰ï¼Œå› æ­¤æ¡†æ¶æä¾›äº†ä¸€å¥—æ›¿ä»£çš„å·¥ä½œæµç¨‹ã€‚

### å‰ç½®æ¡ä»¶

è¦å¯ç”¨ UI è¿˜åŸèƒ½åŠ›ï¼Œé¡¹ç›®çš„ `config.yaml` éœ€è¦é…ç½®ä»¥ä¸‹è·¯å¾„ï¼š

```yaml
# project/config.yaml ä¸­çš„ç›¸å…³é…ç½®
paths:
  docs:
    prototypes: "path/to/prototype/"     # UI åŸå‹ HTML æ–‡ä»¶ç›®å½•
    source: "path/to/source/"            # PRD æºæ–‡ä»¶ç›®å½•ï¼ˆå¯é€‰ï¼‰
```

### UI è¿˜åŸ Ticket çš„ç‰¹æ®Šå­—æ®µ

UI è¿˜åŸ Ticket ä½¿ç”¨ `type: frontend-ui`ï¼Œå¹¶åŒ…å«ä»¥ä¸‹ä¸“å±å­—æ®µï¼š

```yaml
# Ticket YAML æ¨¡æ¿
id: T-xxx
type: frontend-ui                        # ç‰¹æ®Šç±»å‹æ ‡è®°
agent: "{ui-agent-name}"                 # é¡¹ç›®å®šä¹‰çš„ UI Agent

# UI è¿˜åŸä¸“å±å­—æ®µ
prototype_ref: "${config.paths.docs.prototypes}{file}#section"
design_tokens_ref: ".claude/project/agents/{ui-agent}.md#è®¾è®¡ Token"

allowed_paths:
  modify:
    - "${config.paths.frontend.source}{package}/src/views/..."
    - "${config.paths.frontend.source}{package}/src/components/..."
  read:
    - "${config.paths.docs.prototypes}{file}"
    - "${config.paths.frontend.source}shared/src/api/"

# éªŒæ”¶æ ‡å‡†ï¼ˆé TDDï¼‰
acceptance:
  - type: command
    run: "${config.commands.frontend.lint}"
    expect: "No errors"
  - type: command
    run: "${config.commands.frontend.build}"
    expect: "Build successful"
  - type: visual
    description: "é¡µé¢å¸ƒå±€ã€é¢œè‰²ã€é—´è·ä¸åŸå‹ä¸€è‡´"
    prototype: "${config.paths.docs.prototypes}{file}"
    target_section: "{section}"
```

### æ‰§è¡Œæµç¨‹

UI è¿˜åŸ Ticket ç”± `deliver-ticket` Skill ä¸­çš„**æµç¨‹ Bï¼ˆUI è¿˜åŸæµç¨‹ï¼‰**å¤„ç†ï¼š

1. **è¯»å–åŸå‹**ï¼šè¯»å– `prototype_ref` æŒ‡å‘çš„ HTML æ–‡ä»¶
2. **æå–ç»“æ„å’Œæ ·å¼**ï¼šè§£æ HTML ä¸­çš„æ ‡ç­¾ç»“æ„ã€CSS æ ·å¼
3. **ç»„ä»¶æ˜ å°„**ï¼šå°†åŸå‹å…ƒç´ æ˜ å°„ä¸ºç›®æ ‡ UI æ¡†æ¶çš„ç»„ä»¶ï¼ˆæ˜ å°„è¡¨ç”±é¡¹ç›® Agent å®šä¹‰ï¼‰
4. **ç¼–å†™ä»£ç **ï¼šåˆ›å»ºç»„ä»¶ + æ ·å¼ä»£ç 
5. **Lint + Build éªŒè¯**ï¼šè¿è¡Œå·¥ç¨‹å‘½ä»¤ç¡®ä¿æ— ç¼–è¯‘é”™è¯¯
6. **è‡ªæˆ‘å®¡æŸ¥**ï¼šæ‰§è¡Œ UI ä¸“é¡¹å®¡æŸ¥æ¸…å•ï¼ˆè§†è§‰è¿˜åŸã€ç»„ä»¶æ˜ å°„ã€å·¥ç¨‹è´¨é‡ï¼‰

### Agent é€‰æ‹©ï¼ˆæ‰©å±• type æ˜ å°„ï¼‰

`Step 3: ç¡®å®š Agent` ä¸­çš„ type æ˜ å°„æ–°å¢ `frontend-ui` ç±»å‹ï¼š

```python
# æ ¹æ® type æ˜ å°„ Agentï¼ˆä» config.developers å’Œé¡¹ç›® Agent æ–‡ä»¶ä¸­è·å–ï¼‰
type_to_agent = {
    "backend":      # â†’ .claude/project/agents/{backend-agent}.md
    "frontend":     # â†’ .claude/project/agents/{frontend-agent}.md
    "frontend-ui":  # â†’ .claude/project/agents/{ui-agent}.mdï¼ˆé¡¹ç›®è‡ªå®šä¹‰ï¼‰
    "database":     # â†’ .claude/project/agents/{dba-agent}.md
}
```

> å…·ä½“çš„ Agent åç§°ç”±é¡¹ç›®åœ¨ `config.yaml` çš„ `developers` åˆ—è¡¨ä¸­æ³¨å†Œï¼Œå¹¶åœ¨ `.claude/project/agents/` ä¸‹æä¾›å¯¹åº”çš„ Agent å®šä¹‰æ–‡ä»¶ã€‚

### brainstorming å¯¹ UI æ¨¡å—çš„æ”¯æŒ

å½“ `config.paths.docs.prototypes` å·²é…ç½®æ—¶ï¼Œbrainstorming Skill ä¼šï¼š

1. è‡ªåŠ¨æ‰«æ `${config.paths.docs.prototypes}` ç›®å½•ï¼ŒæŸ¥æ‰¾ä¸æ¨¡å—ååŒ¹é…çš„åŸå‹æ–‡ä»¶
2. è¯»å–åŸå‹ HTMLï¼Œè¯†åˆ«æ‰€æœ‰é¡µé¢å’Œç»„ä»¶
3. è¯»å–ç›¸å…³ PRD æ–‡æ¡£ï¼ˆ`${config.paths.docs.source}` ä¸‹æ¨¡å—ååŒ¹é…çš„æ–‡ä»¶ï¼‰
4. ç”Ÿæˆ UI è¿˜åŸéœ€æ±‚æ–‡æ¡£ï¼ŒåŒ…å«ï¼š
   - é¡µé¢æ¸…å•ï¼ˆä»åŸå‹ HTML çš„å¯¼èˆªå’Œè·¯ç”±ç»“æ„æå–ï¼‰
   - ç»„ä»¶æ¸…å•ï¼ˆä» CSS ç±»åå’Œ HTML ç»“æ„æå–ï¼‰
   - è®¾è®¡ Token å®šä¹‰
   - ä¾èµ–çš„åç«¯ API åˆ—è¡¨

### é¡¹ç›® Agent éœ€è¦å®šä¹‰çš„å†…å®¹

æ¯ä¸ªéœ€è¦ UI è¿˜åŸçš„é¡¹ç›®ï¼Œåº”åœ¨ `.claude/project/agents/` ä¸‹åˆ›å»ºå¯¹åº”çš„ Agent æ–‡ä»¶ï¼ŒåŒ…å«ï¼š

1. **è®¾è®¡ Token**ï¼šä»åŸå‹ CSS ä¸­æå–çš„é¢œè‰²ã€åœ†è§’ã€é—´è·ã€å­—ä½“ã€é˜´å½±ç­‰å˜é‡
2. **ç»„ä»¶æ˜ å°„è¡¨**ï¼šåŸå‹ HTML å…ƒç´  â†’ ç›®æ ‡ UI æ¡†æ¶ç»„ä»¶çš„æ˜ å°„å…³ç³»
3. **ç›®å½•çº¦å®š**ï¼šé¡µé¢ã€ç»„ä»¶ã€æ ·å¼æ–‡ä»¶çš„å­˜æ”¾ç»“æ„
4. **UI éªŒæ”¶æ ‡å‡†**ï¼šlint / build å‘½ä»¤ + è§†è§‰æ¯”å¯¹è¦æ±‚

---

## 5. ä¼šè¯æ¢å¤å®ç°

### æ¢å¤æµç¨‹

```python
def restore_session():
    # 1. è¯»å–é…ç½®
    config = load_yaml(".claude/project/config.yaml")
    
    # 2. è¯»å–çŠ¶æ€
    state = load_yaml("osg-spec-docs/tasks/STATE.yaml")
    
    # 3. è¯»å–è®°å¿†
    session = load_yaml(".claude/memory/session.yaml")
    decisions = load_yaml(".claude/memory/decisions.yaml")
    
    # 4. åŠ è½½æœ€è¿‘æ‘˜è¦ï¼ˆå¦‚æœ‰ï¼‰
    summaries_dir = ".claude/memory/summaries/"
    latest_summary = get_latest_file(summaries_dir)
    if latest_summary:
        summary_content = read_file(latest_summary)
    
    # 5. ç”Ÿæˆæ¢å¤æŠ¥å‘Š
    report = generate_restore_report(state, session, decisions, summary_content)
    
    return report
```

### æ¢å¤æŠ¥å‘Šæ¨¡æ¿

```markdown
## ğŸ”„ ä¼šè¯æ¢å¤

**ä¸Šæ¬¡ä¼šè¯**: {session.last_active}
**å½“å‰é˜¶æ®µ**: {state.workflow.current_step}
**å½“å‰ä»»åŠ¡**: {state.current.story} / {state.current.ticket}

### è¿›åº¦
- Story {story_id}: {story_title} ({progress})
- ä¸‹ä¸€ä¸ª Ticket: {next_ticket_id} - {next_ticket_title}

### é‡è¦å†³ç­–
{decisions_list}

### å†å²æ‘˜è¦
{summary_content}

### å¯ç”¨æ“ä½œ
- `/next` - ç»§ç»­æ‰§è¡Œ {next_ticket_id}
- `/status` - æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
- `/restore CP-xxx` - æ¢å¤åˆ°æŒ‡å®šæ£€æŸ¥ç‚¹

---
ç»§ç»­æ‰§è¡Œ {next_ticket_id} å—ï¼Ÿè¾“å…¥ `/next` æˆ–å…¶ä»–å‘½ä»¤ã€‚
```

---

## 6. é”™è¯¯å¤„ç†å®ç°

### æµ‹è¯•å¤±è´¥è‡ªåŠ¨ä¿®å¤

```python
def handle_test_failure(ticket, failure_info, attempt):
    MAX_RETRIES = 3
    
    if attempt >= MAX_RETRIES:
        return {
            'action': 'stop',
            'reason': 'max_retries_reached',
            'message': f'æµ‹è¯•å¤±è´¥ï¼Œå·²é‡è¯• {MAX_RETRIES} æ¬¡'
        }
    
    # è°ƒç”¨ debugging skill åˆ†æ
    analysis = invoke_skill('debugging', {
        'error': failure_info,
        'files': ticket['allowed_paths']['modify']
    })
    
    # å°è¯•è‡ªåŠ¨ä¿®å¤
    if analysis.get('auto_fixable'):
        apply_fix(analysis['fix'])
        return {
            'action': 'retry',
            'reason': 'auto_fixed',
            'fix_applied': analysis['fix']
        }
    else:
        return {
            'action': 'stop',
            'reason': 'need_human_intervention',
            'analysis': analysis
        }
```

### è·¯å¾„è¿è§„æ£€æµ‹

```python
def check_path_violation(modified_files, allowed_paths):
    violations = []
    
    for file_path in modified_files:
        allowed = False
        for pattern in allowed_paths['modify']:
            if fnmatch(file_path, pattern):
                allowed = True
                break
        
        if not allowed:
            violations.append(file_path)
    
    if violations:
        return {
            'violation': True,
            'files': violations,
            'action': 'stop_and_rollback'
        }
    
    return {'violation': False}
```

---

## 7. /init-project å‘½ä»¤å®ç°

### å®ç°è„šæœ¬

```bash
#!/bin/bash
# init-project.sh

PROJECT_NAME=$1
STACK=$2  # æ ¼å¼: java,vue,mysql

# è§£ææŠ€æœ¯æ ˆ
IFS=',' read -ra TECHS <<< "$STACK"

# 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p .claude/skills
mkdir -p .claude/agents
mkdir -p .claude/templates
mkdir -p .claude/project/agents
mkdir -p .claude/project/rules
mkdir -p .claude/memory/summaries
mkdir -p .claude/checkpoints
mkdir -p .claude/commands
mkdir -p docs/requirements
mkdir -p osg-spec-docs/tasks/stories
mkdir -p osg-spec-docs/tasks/tickets
mkdir -p workspace/logs
mkdir -p artifacts/reviews

# 2. å¤åˆ¶æ ¸å¿ƒæ¡†æ¶ï¼ˆå‡è®¾æœ‰æ¨¡æ¿ç›®å½•ï¼‰
cp -r /path/to/core-template/.claude/* .claude/

# 3. ç”Ÿæˆé¡¹ç›®é…ç½®
cat > .claude/project/config.yaml << EOF
name: $PROJECT_NAME
type: fullstack

tech_stack:
$(for tech in "${TECHS[@]}"; do
  case $tech in
    java) echo "  backend:
    language: java
    framework: spring-boot" ;;
    vue) echo "  frontend:
    language: javascript
    framework: vue" ;;
    mysql) echo "  database:
    type: mysql" ;;
  esac
done)

commands:
  test: "mvn -q test"
  build: "mvn -q -DskipTests package"
  lint: "mvn checkstyle:check"

developers:
$(for tech in "${TECHS[@]}"; do
  case $tech in
    java) echo "  - backend-java" ;;
    vue) echo "  - frontend-vue" ;;
    mysql) echo "  - dba-mysql" ;;
  esac
done)

approval:
  story_split: required
  ticket_split: required
  ticket_done: auto
  story_done: required

memory:
  compression_threshold: 70%
  checkpoint_interval: per_ticket
EOF

# 4. åˆå§‹åŒ– STATE.yaml
cat > osg-spec-docs/tasks/STATE.yaml << EOF
version: "1.0"
last_updated: "$(date -u +"%Y-%m-%dT%H:%M:%SZ")"
phase: research
current:
  requirement: null
  story: null
  ticket: null
  agent: null
requirements: []
stories: {}
stats:
  total_requirements: 0
  completed_requirements: 0
  total_stories: 0
  completed_stories: 0
  total_tickets: 0
  completed_tickets: 0
  failed_tickets: 0
  blocked_tickets: 0
checkpoints:
  last: null
  count: 0
context:
  usage_percent: 0
  last_compression: null
  compression_count: 0
session:
  id: ""
  started_at: ""
  last_active: ""
approvals:
  stories_approved: false
  tickets_approved: false
config:
  project: .claude/project/config.yaml
  loaded_at: ""
EOF

# 5. åˆ›å»º CLAUDE.md
cat > .claude/CLAUDE.md << EOF
# ä¸€äººå…¬å¸ AI äº¤ä»˜æ¡†æ¶

## é¡¹ç›®: $PROJECT_NAME

## åŠ è½½é…ç½®
- æ ¸å¿ƒæ¡†æ¶: .claude/
- é¡¹ç›®é…ç½®: .claude/project/config.yaml
- å½“å‰çŠ¶æ€: osg-spec-docs/tasks/STATE.yaml

## å¯ç”¨å‘½ä»¤
| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| /brainstorm | å¤´è„‘é£æš´ï¼Œç»†åŒ–éœ€æ±‚ |
| /split story | å°†éœ€æ±‚æ‹†è§£ä¸º Story |
| /split ticket S-xxx | å°† Story æ‹†è§£ä¸º Ticket |
| /approve | å®¡æ‰¹æ‹†è§£ç»“æœ |
| /next | æ‰§è¡Œä¸‹ä¸€ä¸ª Ticket |
| /status | æŸ¥çœ‹å½“å‰è¿›åº¦ |
| /checkpoint | ä¿å­˜æ£€æŸ¥ç‚¹ |
| /restore | æ¢å¤æ£€æŸ¥ç‚¹ |
| /rollback | å›æ»šå˜æ›´ |

## å¼€å§‹ä½¿ç”¨
1. å°†éœ€æ±‚æ”¾åˆ° docs/requirements/REQ-001.md
2. è¿è¡Œ /brainstorm ç»†åŒ–éœ€æ±‚
3. è¿è¡Œ /split story æ‹†è§£ Stories
4. è¿è¡Œ /approve stories å®¡æ‰¹
5. è¿è¡Œ /split ticket S-001 æ‹†è§£ Tickets
6. è¿è¡Œ /approve tickets å®¡æ‰¹
7. è¿è¡Œ /next å¼€å§‹æ‰§è¡Œ
EOF

echo "âœ… é¡¹ç›®åˆå§‹åŒ–å®Œæˆ: $PROJECT_NAME"
echo "ä¸‹ä¸€æ­¥: å°†éœ€æ±‚æ”¾åˆ° docs/requirements/REQ-001.md"
```

---

## 8. éœ€æ±‚è¯†åˆ«ä¸æ³¨å†Œæœºåˆ¶

### é—®é¢˜èƒŒæ™¯

æ¡†æ¶è¦æ±‚ç”¨æˆ·å°†éœ€æ±‚æ”¾åˆ° `docs/requirements/REQ-xxx.md`ï¼Œä½†æ¡†æ¶å¦‚ä½•çŸ¥é“æœ‰æ–°éœ€æ±‚ï¼ŸSTATE.yaml ä¸­çš„ `requirements` å­—æ®µå¦‚ä½•æ›´æ–°ï¼Ÿ

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šæ‰‹åŠ¨æ³¨å†Œï¼ˆæ¨èï¼‰

ç”¨æˆ·æ˜ç¡®å‘ŠçŸ¥æ¡†æ¶è¦å¤„ç†å“ªä¸ªéœ€æ±‚ã€‚

```bash
# æ–¹å¼ 1ï¼šç›´æ¥æŒ‡å®šéœ€æ±‚
/brainstorm REQ-001

# æ–¹å¼ 2ï¼šæ³¨å†Œå‘½ä»¤
/add-requirement docs/requirements/REQ-001.md
```

**æ³¨å†Œæµç¨‹**ï¼š
```python
def add_requirement(req_path):
    # 1. éªŒè¯æ–‡ä»¶å­˜åœ¨
    if not os.path.exists(req_path):
        return error("éœ€æ±‚æ–‡ä»¶ä¸å­˜åœ¨")
    
    # 2. è§£æéœ€æ±‚ ID
    req_id = extract_req_id(req_path)  # ä»æ–‡ä»¶åæˆ–å†…å®¹æå–
    
    # 3. æ›´æ–° STATE.yaml
    state = load_yaml("osg-spec-docs/tasks/STATE.yaml")
    state['requirements'].append({
        'id': req_id,
        'path': req_path,
        'status': 'pending',
        'added_at': datetime.now().isoformat()
    })
    state['current']['requirement'] = req_id
    save_yaml("osg-spec-docs/tasks/STATE.yaml", state)
    
    return success(f"éœ€æ±‚ {req_id} å·²æ³¨å†Œ")
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
## âœ… éœ€æ±‚å·²æ³¨å†Œ

- **ID**: REQ-001
- **è·¯å¾„**: docs/requirements/REQ-001.md
- **çŠ¶æ€**: pending

**ä¸‹ä¸€æ­¥**: è¿è¡Œ `/brainstorm` ç»†åŒ–éœ€æ±‚
```

#### æ–¹æ¡ˆ Bï¼šè‡ªåŠ¨æ‰«æ

åœ¨ `/brainstorm` æˆ– `/split story` æ‰§è¡Œæ—¶è‡ªåŠ¨æ‰«æ `docs/requirements/` ç›®å½•ã€‚

```python
def auto_scan_requirements():
    req_dir = "docs/requirements/"
    state = load_yaml("osg-spec-docs/tasks/STATE.yaml")
    existing_ids = [r['id'] for r in state.get('requirements', [])]
    
    new_reqs = []
    for file in glob.glob(f"{req_dir}REQ-*.md"):
        req_id = extract_req_id(file)
        if req_id not in existing_ids:
            new_reqs.append({
                'id': req_id,
                'path': file,
                'status': 'pending',
                'added_at': datetime.now().isoformat()
            })
    
    if new_reqs:
        state['requirements'].extend(new_reqs)
        save_yaml("osg-spec-docs/tasks/STATE.yaml", state)
        return new_reqs
    
    return []
```

**è‡ªåŠ¨æ‰«æè§¦å‘æ—¶æœº**ï¼š
- `/brainstorm`ï¼ˆæ— å‚æ•°æ—¶ï¼‰
- `/split story`ï¼ˆæ— å‚æ•°æ—¶ï¼‰
- `/status`ï¼ˆæ˜¾ç¤ºæ–°å‘ç°çš„éœ€æ±‚ï¼‰

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
## ğŸ“‹ å‘ç°æ–°éœ€æ±‚

| ID | è·¯å¾„ | å‘ç°æ—¶é—´ |
|----|------|----------|
| REQ-001 | docs/requirements/REQ-001.md | åˆšåˆš |
| REQ-002 | docs/requirements/REQ-002.md | åˆšåˆš |

**ä¸‹ä¸€æ­¥**:
- å¤„ç† REQ-001: `/brainstorm REQ-001`
- æŸ¥çœ‹æ‰€æœ‰éœ€æ±‚: `/status --requirements`
```

### æ¨èåšæ³•

1. **é¦–æ¬¡ä½¿ç”¨**ï¼šæ‰‹åŠ¨æŒ‡å®š `/brainstorm REQ-001`
2. **åç»­éœ€æ±‚**ï¼šæ”¾å…¥ `docs/requirements/` åè¿è¡Œ `/status` ä¼šæç¤ºå‘ç°æ–°éœ€æ±‚
3. **æ‰¹é‡å¤„ç†**ï¼šä½¿ç”¨ `/brainstorm --all` ä¾æ¬¡å¤„ç†æ‰€æœ‰ pending éœ€æ±‚

### éœ€æ±‚å‘½åè§„èŒƒ

```
docs/requirements/
â”œâ”€â”€ REQ-001.md           # æ ¼å¼: REQ-{åºå·}.md
â”œâ”€â”€ REQ-002-user-module.md   # å¯é€‰: REQ-{åºå·}-{ç®€è¿°}.md
â””â”€â”€ REQ-003.md
```

æ–‡ä»¶å†…å®¹é¦–è¡Œåº”åŒ…å«éœ€æ±‚ IDï¼š
```markdown
# REQ-001: ç”¨æˆ·ç®¡ç†æ¨¡å—

## èƒŒæ™¯
...
```

---

## 9. å¤š Story æ‰§è¡Œç­–ç•¥

### é—®é¢˜èƒŒæ™¯

å½“æœ‰å¤šä¸ª Storyï¼ˆS-001, S-002ï¼‰æ—¶ï¼Œ`/next` å‘½ä»¤æŒ‰ä»€ä¹ˆé¡ºåºæ‰§è¡Œ Ticketsï¼Ÿ

### è§£å†³æ–¹æ¡ˆ

åœ¨ `project/config.yaml` ä¸­é…ç½®æ‰§è¡Œç­–ç•¥ï¼š

```yaml
# project/config.yaml
execution:
  # æ‰§è¡Œæ¨¡å¼
  mode: sequential  # sequential | parallel | priority
  
  # sequential æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
  # å®Œæˆ S-001 æ‰€æœ‰ Tickets åï¼Œå†æ‰§è¡Œ S-002
  sequential:
    order: "by_priority"  # by_priority | by_id | by_dependency
  
  # parallel æ¨¡å¼ï¼ˆéœ€è¦ Git Worktreeï¼‰
  # å¤šä¸ª Story å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
  parallel:
    max_parallel_stories: 2
    isolation: "worktree"  # worktree | branch
  
  # priority æ¨¡å¼
  # æŒ‰ Ticket ä¼˜å…ˆçº§è·¨ Story æ‰§è¡Œ
  priority:
    p0_first: true
    same_priority_order: "by_story"  # by_story | by_id
```

### æ‰§è¡Œç­–ç•¥è¯¦è§£

#### 1. Sequentialï¼ˆé¡ºåºæ¨¡å¼ï¼‰- é»˜è®¤

```
S-001: T-001 â†’ T-002 â†’ T-003 â†’ å®Œæˆ
S-002: T-004 â†’ T-005 â†’ å®Œæˆ
```

**ä¼˜ç‚¹**ï¼šç®€å•ï¼Œæ— å†²çª
**ç¼ºç‚¹**ï¼šæ•ˆç‡ä½ï¼Œæ— æ³•å¹¶è¡Œ

#### 2. Parallelï¼ˆå¹¶è¡Œæ¨¡å¼ï¼‰

```
Worktree-1 (S-001): T-001 â†’ T-002 â†’ T-003
Worktree-2 (S-002): T-004 â†’ T-005
```

**ä¼˜ç‚¹**ï¼šæ•ˆç‡é«˜
**ç¼ºç‚¹**ï¼šå¤æ‚ï¼Œéœ€è¦ Git Worktree

#### 3. Priorityï¼ˆä¼˜å…ˆçº§æ¨¡å¼ï¼‰

```
P0: T-001 (S-001), T-004 (S-002)
P1: T-002 (S-001), T-005 (S-002)
P2: T-003 (S-001)
```

**ä¼˜ç‚¹**ï¼šå…³é”®åŠŸèƒ½å…ˆå®Œæˆ
**ç¼ºç‚¹**ï¼šStory å®Œæ•´æ€§è¾ƒå·®

### /next å‘½ä»¤çš„é€‰æ‹©é€»è¾‘

```python
def get_next_ticket(config):
    mode = config.get('execution', {}).get('mode', 'sequential')
    
    if mode == 'sequential':
        # æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœªå®Œæˆçš„ Storyï¼Œæ‰§è¡Œå…¶ pending Ticket
        for story in get_stories_by_order():
            if story.status != 'completed':
                for ticket in story.tickets:
                    if ticket.status == 'pending':
                        return ticket
                        
    elif mode == 'priority':
        # æ‰¾åˆ°æœ€é«˜ä¼˜å…ˆçº§çš„ pending Ticket
        return get_highest_priority_pending_ticket()
        
    elif mode == 'parallel':
        # è¿”å›å½“å‰ worktree å¯¹åº” Story çš„ pending Ticket
        current_story = get_current_worktree_story()
        return get_pending_ticket(current_story)
    
    return None
```

### æ¨èé…ç½®ï¼ˆè‹¥ä¾é¡¹ç›®ï¼‰

```yaml
# è‹¥ä¾é¡¹ç›®æ¨èï¼šé¡ºåºæ¨¡å¼
execution:
  mode: sequential
  sequential:
    order: by_priority  # P0 Story å…ˆæ‰§è¡Œ
```

---

## 10. Cursor å¹³å°é™åˆ¶ä¸çº¦æŸ

### å¹³å°é™åˆ¶è¯´æ˜

æœ¬æ¡†æ¶è®¾è®¡åŸºäº Cursor IDE + Claude æ¨¡å‹ï¼Œä»¥ä¸‹æ˜¯å¹³å°ç›¸å…³çš„é™åˆ¶å’Œå¯¹åº”çš„å¤„ç†æ–¹å¼ï¼š

### 10.1 æ— æ³•çœŸæ­£å®ç°çš„åŠŸèƒ½

| åŠŸèƒ½ | é™åˆ¶åŸå›  | æ›¿ä»£æ–¹æ¡ˆ |
|------|----------|----------|
| **çœŸæ­£çš„ Subagent** | Cursor ä¸æ”¯æŒå¤šè¿›ç¨‹ AI | é€šè¿‡ Prompt åˆ‡æ¢è§’è‰²æ¨¡æ‹Ÿ |
| **ç²¾ç¡®çš„ Token è®¡æ•°** | API ä¸æš´éœ² token ä½¿ç”¨é‡ | åŸºäºå­—ç¬¦æ•°/è½®æ¬¡ä¼°ç®— |
| **ä¼šè¯ç»“æŸäº‹ä»¶** | æ— æ³•æ£€æµ‹ç”¨æˆ·ä½•æ—¶å…³é—­ | å»ºè®®ç”¨æˆ·ä¸»åŠ¨ `/save` |
| **åå°æŒç»­è¿è¡Œ** | æ— å®ˆæŠ¤è¿›ç¨‹èƒ½åŠ› | Ralph Loop åœ¨å•æ¬¡ä¼šè¯å†…æ‰§è¡Œ |
| **è·¨ä¼šè¯çŠ¶æ€** | æ¯æ¬¡ä¼šè¯æ˜¯ç‹¬ç«‹çš„ | é€šè¿‡ YAML æ–‡ä»¶æŒä¹…åŒ–çŠ¶æ€ |

### 10.2 ä¾èµ– YAML æ–‡ä»¶çš„å…³é”®çº¦æŸ

ç”±äº Cursor æ¯æ¬¡ä¼šè¯æ˜¯ç‹¬ç«‹çš„ï¼Œ**æ‰€æœ‰çŠ¶æ€å¿…é¡»é€šè¿‡ YAML æ–‡ä»¶ä¼ é€’**ï¼š

```yaml
# âš ï¸ å…³é”®çº¦æŸ
constraints:
  # 1. æ¯æ¬¡å‘½ä»¤æ‰§è¡Œå‰å¿…é¡»è¯»å–çŠ¶æ€
  before_execution:
    - è¯»å– osg-spec-docs/tasks/STATE.yaml
    - è¯»å–ç›¸å…³çš„ Ticket/Story YAML
    - ä¸èƒ½ä¾èµ–"è®°å¿†"ä¸­çš„çŠ¶æ€
    
  # 2. æ¯æ¬¡å‘½ä»¤æ‰§è¡Œåå¿…é¡»æ›´æ–°çŠ¶æ€
  after_execution:
    - æ›´æ–° osg-spec-docs/tasks/STATE.yaml
    - æ›´æ–° Ticket.status
    - åˆ›å»ºæ—¥å¿— workspace/logs/T-xxx.yaml
    
  # 3. æ£€æŸ¥ç‚¹æ˜¯å”¯ä¸€çš„æ¢å¤æœºåˆ¶
  recovery:
    - æ— æ³•"æ’¤é”€"ä¸Šä¸€æ­¥æ“ä½œ
    - åªèƒ½å›æ»šåˆ°æ£€æŸ¥ç‚¹
    - æ£€æŸ¥ç‚¹ = Git commit + STATE å¿«ç…§
```

### 10.3 å¯¹ä¾¿å®œæ¨¡å‹çš„é¢å¤–çº¦æŸ

å¦‚æœä½¿ç”¨è¾ƒä¾¿å®œçš„æ¨¡å‹ï¼ˆå¦‚ Claude Haikuï¼‰æ‰§è¡Œæ¡†æ¶ï¼Œéœ€è¦æ³¨æ„ï¼š

```yaml
cheap_model_constraints:
  # 1. æ›´æ˜ç¡®çš„æŒ‡ä»¤
  explicit_instructions:
    - æ¯ä¸ª Skill çš„æ­¥éª¤å¿…é¡»æ˜¯å®Œæ•´çš„ã€å¯æ‰§è¡Œçš„
    - ä¸èƒ½å‡è®¾æ¨¡å‹"ç†è§£"éšå«çš„ä¸Šä¸‹æ–‡
    - è¾“å‡ºæ ¼å¼å¿…é¡»æœ‰ç¤ºä¾‹
    
  # 2. æ›´çŸ­çš„ä¸Šä¸‹æ–‡çª—å£
  context_management:
    - å‹ç¼©é˜ˆå€¼é™ä½åˆ° 50%
    - æ¯ä¸ª Skill åªåŠ è½½å¿…è¦çš„æ–‡ä»¶
    - é¿å…ä¸€æ¬¡åŠ è½½å¤šä¸ªå¤§æ–‡ä»¶
    
  # 3. æ›´ä¸¥æ ¼çš„éªŒè¯
  validation:
    - æ¯ä¸€æ­¥éƒ½è¦è¾“å‡ºç¡®è®¤
    - ä¸è·³è¿‡ä»»ä½•æ ¡éªŒæ­¥éª¤
    - å¤±è´¥æ—¶ç»™å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
```

### 10.4 å·²éªŒè¯å¯è¡Œçš„åŠŸèƒ½

| åŠŸèƒ½ | å®ç°æ–¹å¼ | éªŒè¯çŠ¶æ€ |
|------|----------|----------|
| è¯»å†™ YAML æ–‡ä»¶ | Cursor åŸç”Ÿæ”¯æŒ | âœ… |
| æ‰§è¡Œ Shell å‘½ä»¤ | Cursor ç»ˆç«¯ | âœ… |
| è¯»å–ä»£ç æ–‡ä»¶ | Cursor åŸç”Ÿæ”¯æŒ | âœ… |
| Git æ“ä½œ | Cursor é›†æˆ Git | âœ… |
| è§’è‰²åˆ‡æ¢ï¼ˆæ¨¡æ‹Ÿï¼‰ | Prompt å£°æ˜ | âœ… |
| è‡ªåŠ¨è¿­ä»£æ‰§è¡Œ | å•æ¬¡ä¼šè¯å†… while å¾ªç¯ | âœ… |

### 10.5 å®ç°å»ºè®®

**é’ˆå¯¹ Cursor + Claude çš„æœ€ä½³å®è·µ**ï¼š

1. **çŠ¶æ€å³æ–‡ä»¶**ï¼šæ‰€æœ‰çŠ¶æ€ä¿å­˜åœ¨ YAML æ–‡ä»¶ä¸­ï¼Œä¸ä¾èµ–æ¨¡å‹è®°å¿†
2. **æ˜¾å¼ä¼˜äºéšå¼**ï¼šæ¯ä¸ªæ­¥éª¤æ˜ç¡®è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•å’Œæ¢å¤
3. **å°æ­¥å¿«è·‘**ï¼šTicket ç²’åº¦è¶³å¤Ÿå°ï¼Œå•ä¸ªå¤±è´¥ä¸å½±å“å…¨å±€
4. **æ£€æŸ¥ç‚¹é¢‘ç¹**ï¼šæ¯ä¸ª Ticket å®Œæˆåè‡ªåŠ¨ä¿å­˜æ£€æŸ¥ç‚¹
5. **äººå·¥å…œåº•**ï¼šå…³é”®å†³ç­–ç‚¹ä¿ç•™äººå·¥å®¡æ‰¹

---

## 11. SKILL.md æ–‡ä»¶æ ¼å¼è§„èŒƒ

### é—®é¢˜èƒŒæ™¯

è®¾è®¡æ–‡æ¡£ä¸­å®šä¹‰äº† 16 ä¸ª Skills çš„ Prompt æ¨¡æ¿ï¼Œä½†æ²¡æœ‰è¯´æ˜ `.claude/skills/{skill-name}/SKILL.md` æ–‡ä»¶çš„å…·ä½“æ ¼å¼ã€‚

### SKILL.md æ–‡ä»¶æ ¼å¼

æ¯ä¸ª Skill ç›®å½•ä¸‹çš„ `SKILL.md` æ–‡ä»¶**å¿…é¡»**åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š

```markdown
---
name: {skill-name}
description: "Use when ... - {è§¦å‘æ¡ä»¶æè¿°}"
metadata:
  invoked-by: "{user | agent | auto}"
  auto-execute: "{true | false}"
---

# {Skill åç§°} Skill

## è§¦å‘æ¡ä»¶

{æè¿°ä½•æ—¶è§¦å‘æ­¤ Skill}

## æ‰§è¡Œæµç¨‹

### Step 1: {æ­¥éª¤å}
{å…·ä½“æ“ä½œ}

### Step 2: {æ­¥éª¤å}
{å…·ä½“æ“ä½œ}

...

## è¾“å…¥è§„èŒƒ

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| {param1} | string | æ˜¯ | {è¯´æ˜} |

## è¾“å‡ºæ ¼å¼

"""
{è¾“å‡ºæ¨¡æ¿ï¼Œä½¿ç”¨å ä½ç¬¦ {xxx}}
"""

## ç¡¬æ€§çº¦æŸ

1. {çº¦æŸ1}
2. {çº¦æŸ2}

## ç¦æ­¢çš„è¡Œä¸º

- âŒ {ç¦æ­¢è¡Œä¸º1}
- âŒ {ç¦æ­¢è¡Œä¸º2}

## å¿…é¡»çš„è¡Œä¸º

- âœ… {å¿…é¡»è¡Œä¸º1}
- âœ… {å¿…é¡»è¡Œä¸º2}
```

### ç¤ºä¾‹ï¼šdeliver-ticket/SKILL.md

```markdown
---
name: deliver-ticket
description: "Use when executing a Ticket - enforces TDD, path constraints, and self-review"
metadata:
  invoked-by: "agent"
  auto-execute: "true"
---

# Deliver-Ticket Skill

## è§¦å‘æ¡ä»¶

- ç”¨æˆ·æ‰§è¡Œ `/next` å‘½ä»¤
- Coordinator Agent åˆ†æ´¾ä»»åŠ¡
- ç”¨æˆ·æ‰§è¡Œ `/retry T-xxx`

## æ‰§è¡Œæµç¨‹

### Step 1: è¯»å– Ticket å®šä¹‰

1. æ‰§è¡Œ: è¯»å– `osg-spec-docs/tasks/tickets/{ticket_id}.yaml`
2. æå–: id, title, description, allowed_paths, tdd, acceptance

### Step 2: è¾“å‡ºç†è§£ç¡®è®¤

è¾“å‡ºæ ¼å¼:
"""
## ğŸ“‹ ä»»åŠ¡ç†è§£

**Ticket**: {id} - {title}
**ç›®æ ‡**: {description ä¸€å¥è¯æ€»ç»“}
**å…è®¸ä¿®æ”¹çš„æ–‡ä»¶**: {allowed_paths.modify}
**éªŒæ”¶æ ‡å‡†**: {acceptance}

âœ… ç†è§£ç¡®è®¤ï¼Œå¼€å§‹æ‰§è¡Œã€‚
"""

### Step 3: TDD çº¢ç¯

1. æ ¹æ® tdd.test_cases ç¼–å†™æµ‹è¯•
2. è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼ˆé¡¹ç›®é…ç½®ä¸­çš„ test å‘½ä»¤ï¼‰
3. **ç¡®è®¤æµ‹è¯•å¤±è´¥**ï¼ˆå› ä¸ºç¼ºå°‘åŠŸèƒ½ï¼‰
4. å¦‚æœæµ‹è¯•ç«‹å³é€šè¿‡ â†’ æ£€æŸ¥æµ‹è¯•æ˜¯å¦æ­£ç¡®

è¾“å‡ºæ ¼å¼:
"""
### ğŸ”´ çº¢ç¯é˜¶æ®µ

æµ‹è¯•æ–‡ä»¶: {test_file}
æµ‹è¯•ç”¨ä¾‹: {test_cases}
è¿è¡Œç»“æœ:
\`\`\`
{æµ‹è¯•è¾“å‡ºï¼Œæ˜¾ç¤ºå¤±è´¥}
\`\`\`
âœ… çº¢ç¯ç¡®è®¤ï¼šæµ‹è¯•å› ç¼ºå°‘åŠŸèƒ½è€Œå¤±è´¥
"""

### Step 4: å®ç°ä»£ç 

1. è¯»å–å‚è€ƒæ–‡ä»¶ (allowed_paths.read)
2. å®ç°æœ€å°‘çš„ä»£ç è®©æµ‹è¯•é€šè¿‡
3. **ä¸¥æ ¼é™åˆ¶åœ¨ allowed_paths.modify èŒƒå›´å†…**

### Step 5: TDD ç»¿ç¯

1. è¿è¡Œæµ‹è¯•
2. ç¡®è®¤æµ‹è¯•é€šè¿‡

è¾“å‡ºæ ¼å¼:
"""
### ğŸŸ¢ ç»¿ç¯é˜¶æ®µ

è¿è¡Œç»“æœ:
\`\`\`
{æµ‹è¯•è¾“å‡ºï¼Œæ˜¾ç¤ºæˆåŠŸ}
\`\`\`
"""

### Step 6: ä»£ç æ£€æŸ¥

1. è¿è¡Œ lint å‘½ä»¤
2. å¦‚æœ‰é—®é¢˜ï¼Œè‡ªåŠ¨ä¿®å¤

### Step 7: è‡ªæˆ‘å®¡æŸ¥

æ‰§è¡Œè‡ªæˆ‘å®¡æŸ¥æ¸…å•:
- [ ] å®ç°äº†æ‰€æœ‰è¦æ±‚ï¼Ÿ
- [ ] æ²¡æœ‰é—æ¼è¾¹ç•Œæƒ…å†µï¼Ÿ
- [ ] ä»£ç æ¸…æ™°å¯ç»´æŠ¤ï¼Ÿ
- [ ] éµå¾ªäº† TDDï¼Ÿ

### Step 8: åˆ›å»ºæ£€æŸ¥ç‚¹

1. è°ƒç”¨ checkpoint-manager Skill
2. æ›´æ–° STATE.yaml

### Step 9: è¾“å‡ºå®ŒæˆæŠ¥å‘Š

è¾“å‡ºæ ¼å¼:
"""
## âœ… Ticket {id} å®ŒæˆæŠ¥å‘Š

### ä¿®æ”¹æ–‡ä»¶
| æ–‡ä»¶ | å˜æ›´ |
|------|------|
| {file} | +{added} -{removed} |

### éªŒè¯è¯æ®
\`\`\`
{éªŒè¯å‘½ä»¤è¾“å‡º}
\`\`\`

### æ£€æŸ¥ç‚¹
å·²ä¿å­˜: {checkpoint_id}
"""

## è¾“å…¥è§„èŒƒ

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| ticket_id | string | æ˜¯ | Ticket IDï¼Œå¦‚ T-001 |

## ç¡¬æ€§çº¦æŸ

1. **ç¦æ­¢ä¿®æ”¹ allowed_paths ä¹‹å¤–çš„æ–‡ä»¶** - è¿åæ—¶ç«‹å³åœæ­¢
2. **ç¦æ­¢è·³è¿‡æµ‹è¯•** - å¿…é¡»å…ˆå†™æµ‹è¯•ï¼Œæµ‹è¯•å¿…é¡»å…ˆå¤±è´¥
3. **ç¦æ­¢è·³è¿‡éªŒè¯å‘½ä»¤** - æ‰€æœ‰ acceptance æ£€æŸ¥å¿…é¡»æ‰§è¡Œ
4. **ç¦æ­¢è·³è¿‡è‡ªæˆ‘å®¡æŸ¥** - å®Œæˆå‰å¿…é¡»æ‰§è¡Œè‡ªæˆ‘å®¡æŸ¥
5. **å®Œæˆåå¿…é¡»åˆ›å»ºæ£€æŸ¥ç‚¹**

## ç¦æ­¢çš„è¡Œä¸º

- âŒ ä¿®æ”¹ allowed_paths ä¹‹å¤–çš„æ–‡ä»¶
- âŒ è·³è¿‡çº¢ç¯é˜¶æ®µ
- âŒ ä¸è¿è¡ŒéªŒè¯å‘½ä»¤å°±å£°ç§°å®Œæˆ
- âŒ é‡åˆ°é˜»å¡ç»§ç»­çŒœæµ‹æ‰§è¡Œ

## å¿…é¡»çš„è¡Œä¸º

- âœ… å…ˆè¾“å‡ºç†è§£ç¡®è®¤
- âœ… TDD çº¢-ç»¿-é‡æ„
- âœ… è¿è¡Œæ‰€æœ‰éªŒæ”¶å‘½ä»¤å¹¶å±•ç¤ºè¾“å‡º
- âœ… å®Œæˆååˆ›å»ºæ£€æŸ¥ç‚¹
```

---

## 12. AGENT.md æ–‡ä»¶æ ¼å¼è§„èŒƒ

### æ ¸å¿ƒ Agent æ¨¡æ¿æ ¼å¼

`.claude/agents/{agent-name}.md` æ–‡ä»¶æ ¼å¼ï¼š

```markdown
---
name: {agent-name}
description: {Agent èŒè´£æè¿°}
tools: Read, Write, Grep, Bash  # å¯ç”¨å·¥å…·
skills: skill1, skill2, skill3  # åŠ è½½çš„ Skills
---

# {Agent åç§°}

## ä½ çš„èŒè´£

{Agent çš„æ ¸å¿ƒèŒè´£æè¿°}

### 1. {èŒè´£1}
- {å…·ä½“è¯´æ˜}

### 2. {èŒè´£2}
- {å…·ä½“è¯´æ˜}

## åŠ è½½çš„ Skills

- {skill1}: {ç”¨é€”}
- {skill2}: {ç”¨é€”}

## å·¥ä½œæµç¨‹

{Agent æ‰§è¡Œä»»åŠ¡çš„æ ‡å‡†æµç¨‹}

## è¾“å‡ºæ ¼å¼

{Agent è¾“å‡ºçš„æ ‡å‡†æ ¼å¼æ¨¡æ¿}

## çº¦æŸ

1. {çº¦æŸ1}
2. {çº¦æŸ2}
```

### é¡¹ç›® Agent å®ä¾‹æ ¼å¼

`.claude/project/agents/{agent-name}.md` æ–‡ä»¶æ ¼å¼ï¼š

```markdown
---
name: {agent-name}
extends: {core-agent}  # ç»§æ‰¿çš„æ ¸å¿ƒ Agent
description: {é¡¹ç›®ç‰¹å®šæè¿°}
skills: {skill1}, {skill2}
rules: {rule-file}  # ä»£ç è§„èŒƒæ–‡ä»¶
---

# {é¡¹ç›® Agent åç§°}

## ç»§æ‰¿è‡ª
agents/{agent}.md

## æŠ€æœ¯æ ˆ
- {æŠ€æœ¯1}
- {æŠ€æœ¯2}

## ä»£ç è§„èŒƒ
å¼•ç”¨: {è§„èŒƒé“¾æ¥æˆ– .claude/project/rules/{rule-file}.md}

å…³é”®è§„èŒƒ:
- {è§„èŒƒ1}
- {è§„èŒƒ2}

## ç›®å½•çº¦å®š
- {ç›®å½•1}: {ç”¨é€”}
- {ç›®å½•2}: {ç”¨é€”}

## å‘½ä»¤
- æµ‹è¯•: {test_command}
- Lint: {lint_command}
- æ„å»º: {build_command}

## é¡¹ç›®ç‰¹å®šçº¦æŸ
{é¡¹ç›®ç‰¹æœ‰çš„çº¦æŸè¯´æ˜}
```

### ç¤ºä¾‹ï¼šbackend-java.md

```markdown
---
name: backend-java
extends: developer
description: Java åç«¯å¼€å‘è€…ï¼Œå¤„ç† Spring Boot ç›¸å…³çš„ Ticket
skills: deliver-ticket, tdd, checkpoint-manager
rules: java
---

# Java åç«¯å¼€å‘è€…

## ç»§æ‰¿è‡ª
agents/developer.md

## æŠ€æœ¯æ ˆ
> âš ï¸ ä» project/config.yaml è¯»å–ï¼Œä¸è¦ç¡¬ç¼–ç 

- è¯­è¨€: ${config.tech_stack.backend.language}
- è¿è¡Œæ—¶: ${config.tech_stack.backend.runtime}
- æ¡†æ¶: ${config.tech_stack.backend.framework} ${config.tech_stack.backend.version}

## ä»£ç è§„èŒƒ
å¼•ç”¨: é˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œ https://github.com/alibaba/p3c

å…³é”®è§„èŒƒ:
- ç±»åä½¿ç”¨ UpperCamelCase
- æ–¹æ³•åä½¿ç”¨ lowerCamelCase
- å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE
- æ‰€æœ‰ Service æ–¹æ³•éœ€è¦æœ‰ JavaDoc
- ç¦æ­¢ä½¿ç”¨é­”æ³•æ•°å­—

## ç›®å½•çº¦å®š
- Controller: ruoyi-admin/src/main/java/**/controller/
- Service Interface: ruoyi-system/src/main/java/**/service/
- Service Impl: ruoyi-system/src/main/java/**/service/impl/
- Mapper: ruoyi-system/src/main/java/**/mapper/
- Test: ruoyi-*/src/test/java/

## å‘½ä»¤
- æµ‹è¯•: mvn test -Dtest={TestClass}
- Lint: mvn checkstyle:check
- æ„å»º: mvn -DskipTests package
```

---

## 13. ä¼šè¯å¯åŠ¨è§¦å‘æœºåˆ¶

### é—®é¢˜èƒŒæ™¯

æ¡†æ¶è®¾è®¡äº†"ä¼šè¯å¯åŠ¨è‡ªåŠ¨æµç¨‹"ï¼Œä½† Cursor å¦‚ä½•çŸ¥é“è¦æ‰§è¡Œè¿™ä¸ªæµç¨‹ï¼Ÿ

### è§£å†³æ–¹æ¡ˆï¼šCLAUDE.md ä½œä¸ºå…¥å£

**åŸç†**ï¼šCursor åœ¨æ‰“å¼€é¡¹ç›®æ—¶ä¼šè‡ªåŠ¨è¯»å– `.claude/CLAUDE.md` æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚

**CLAUDE.md çš„ä½œç”¨**ï¼š
1. ä½œä¸ºé¡¹ç›®çš„ AI é…ç½®å…¥å£
2. åŒ…å«æ¡†æ¶åŠ è½½æŒ‡ä»¤
3. å®šä¹‰å¯ç”¨å‘½ä»¤

### CLAUDE.md å®Œæ•´æ ¼å¼

```markdown
# ä¸€äººå…¬å¸ AI äº¤ä»˜æ¡†æ¶

> é¡¹ç›®: {é¡¹ç›®å}

## âš ï¸ ä¼šè¯å¯åŠ¨æŒ‡ä»¤

**æ¯æ¬¡ä¼šè¯å¼€å§‹æ—¶ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š**

### Step 1: åŠ è½½çŠ¶æ€
è¯»å– `osg-spec-docs/tasks/STATE.yaml`ï¼Œè·å–ï¼š
- phase: å½“å‰é˜¶æ®µ
- current: å½“å‰ä»»åŠ¡
- stats: ç»Ÿè®¡ä¿¡æ¯

### Step 2: æ£€æŸ¥æ¢å¤
å¦‚æœ `current.ticket` ä¸ä¸ºç©ºï¼š
- è¯»å–å¯¹åº”çš„ Ticket æ–‡ä»¶
- è¾“å‡ºæ¢å¤æŠ¥å‘Š

### Step 3: è¾“å‡ºæ¬¢è¿ä¿¡æ¯

å¦‚æœæ˜¯æ–°é¡¹ç›®ï¼ˆSTATE.yaml ä¸å­˜åœ¨æˆ– phase ä¸ºç©ºï¼‰ï¼š
"""
## ğŸ‘‹ æ¬¢è¿ä½¿ç”¨ä¸€äººå…¬å¸ AI äº¤ä»˜æ¡†æ¶

æ£€æµ‹åˆ°è¿™æ˜¯æ–°é¡¹ç›®ï¼Œè¯·å…ˆåˆå§‹åŒ–ï¼š

1. è¿è¡Œ `/init-project {é¡¹ç›®å}`
2. å°†éœ€æ±‚æ”¾åˆ° `docs/requirements/REQ-001.md`
3. è¿è¡Œ `/add-requirement REQ-001`
4. è¿è¡Œ `/brainstorm` å¼€å§‹å·¥ä½œ
"""

å¦‚æœæ˜¯æ¢å¤ä¼šè¯ï¼š
"""
## ğŸ”„ ä¼šè¯æ¢å¤

**ä¸Šæ¬¡ä¼šè¯**: {session.last_active}
**å½“å‰é˜¶æ®µ**: {phase}
**å½“å‰ä»»åŠ¡**: {current.story} / {current.ticket}

### è¿›åº¦
- Story {story_id}: {progress}
- ä¸‹ä¸€ä¸ª Ticket: {next_ticket}

### å¯ç”¨æ“ä½œ
- `/next` - ç»§ç»­æ‰§è¡Œ
- `/status` - æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
"""

## è‡ªåŠ¨æ‰§è¡Œæ¨¡å¼

æœ¬æ¡†æ¶çš„ Skills é‡‡ç”¨ã€Œè‡ªåŠ¨æ‰§è¡Œæ¨¡å¼ã€ï¼š
- ä¸€æ¬¡è§¦å‘ï¼Œå®Œæ•´æ‰§è¡Œ
- å¾ªç¯è¿­ä»£ï¼Œç›´åˆ°æ ¡éªŒé€šè¿‡
- åªè¾“å‡ºæœ€ç»ˆç»“æœ
- ä¸ç­‰å¾…ç”¨æˆ·ç¡®è®¤

### å·¥ä½œæµè½¬æ¢ä¸è‡ªåŠ¨ç»§ç»­æœºåˆ¶

ä¸ºäº†å®ç°"è‡ªåŠ¨æ‰§è¡Œåˆ°å®¡æ‰¹ç‚¹"ï¼Œæ¡†æ¶å¼•å…¥äº†å·¥ä½œæµçŠ¶æ€æœºæœºåˆ¶ã€‚

#### å·¥ä½œæµçŠ¶æ€æœºå­—æ®µ

åœ¨ `osg-spec-docs/tasks/STATE.yaml` ä¸­ç»´æŠ¤ `workflow` å­—æ®µï¼š

```yaml
workflow:
  current_step: brainstorm_done    # å½“å‰å®Œæˆçš„æ­¥éª¤
  next_step: split_story           # ä¸‹ä¸€æ­¥è¦æ‰§è¡Œçš„å‘½ä»¤
  next_requires_approval: false   # ä¸‹ä¸€æ­¥æ˜¯å¦éœ€è¦å®¡æ‰¹ï¼ˆä» config.yaml è¯»å–ï¼‰
  auto_continue: true              # æ˜¯å¦è‡ªåŠ¨ç»§ç»­ï¼ˆå¦‚æœä¸éœ€è¦å®¡æ‰¹åˆ™è‡ªåŠ¨æ‰§è¡Œï¼‰
```

#### å·¥ä½œæµè½¬æ¢è¡¨

| å½“å‰æ­¥éª¤ | ä¸‹ä¸€æ­¥ | å®¡æ‰¹é…ç½®é”® | é»˜è®¤è¡Œä¸º | è¯´æ˜ |
|----------|--------|------------|----------|------|
| `brainstorm_done` | `split_story` | - | auto | éœ€æ±‚åˆ†æå®Œæˆåè‡ªåŠ¨æ‹†åˆ† Stories |
| `story_split_done` | `approve_stories` | `story_split` | required | Story æ‹†åˆ†åéœ€è¦å®¡æ‰¹ |
| `stories_approved` | `split_ticket` | - | auto | Stories å®¡æ‰¹åè‡ªåŠ¨æ‹†ç¬¬ä¸€ä¸ª Story çš„ Tickets |
| `ticket_split_done` | `approve_tickets` | `ticket_split` | required | Ticket æ‹†åˆ†åéœ€è¦å®¡æ‰¹ |
| `ticket_approved` | `next` | - | auto | å®¡æ‰¹é€šè¿‡åè‡ªåŠ¨æ‰§è¡Œç¬¬ä¸€ä¸ª Ticket |
| `ticket_done` | `next` (å¾ªç¯) | `ticket_done` | auto | Ticket å®Œæˆåè‡ªåŠ¨æ‰§è¡Œä¸‹ä¸€ä¸ª |
| `all_tickets_done` | `verify` | - | auto | æ‰€æœ‰ Tickets å®Œæˆåè‡ªåŠ¨éªŒæ”¶ |
| `story_done` | `approve_story` | `story_done` | required | Story å®Œæˆåéœ€è¦å®¡æ‰¹ |
| `story_approved` | `next_story` | - | auto | Story å®¡æ‰¹åæ£€æŸ¥æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ª Story |
| `all_stories_done` | `null` | - | - | æ‰€æœ‰ Stories å®Œæˆï¼Œå·¥ä½œæµç»“æŸ |

#### å“åº”ç»“æŸè§„åˆ™

æ¯æ¬¡å“åº”ç»“æŸå‰ï¼ŒAI å¿…é¡»æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼ˆå®šä¹‰åœ¨ `.claude/CLAUDE.md` ä¸­ï¼‰ï¼š

```
1. è¯»å– osg-spec-docs/tasks/STATE.yaml çš„ workflow å­—æ®µ
   - å¦‚æœ workflow ä¸å­˜åœ¨ â†’ è·³è¿‡è‡ªåŠ¨ç»§ç»­ï¼ˆé¦–æ¬¡æ‰§è¡Œï¼‰
   - å¦‚æœå­˜åœ¨ â†’ è·å– current_step å’Œ next_step

2. å¦‚æœ next_step ä¸ºç©º â†’ åœæ­¢ï¼ˆå·¥ä½œæµç»“æŸï¼‰

3. æ ¹æ® next_step æŸ¥æ‰¾å®¡æ‰¹é…ç½®é”®ï¼ˆä½¿ç”¨æ˜ å°„è¡¨ï¼‰ï¼š
   - next_step = "approve_stories" â†’ config.approval.story_split
   - next_step = "approve_tickets" â†’ config.approval.ticket_split
   - next_step = "approve_story" â†’ config.approval.story_done
   - next_step = "next" â†’ config.approval.ticket_done
   - å…¶ä»– â†’ ä¸éœ€è¦å®¡æ‰¹ï¼ˆautoï¼‰

4. åˆ¤æ–­æ˜¯å¦è‡ªåŠ¨ç»§ç»­ï¼š
   - å¦‚æœå®¡æ‰¹é…ç½®å€¼ä¸º "auto" æˆ–ä¸å­˜åœ¨ â†’ next_requires_approval = false
   - å¦‚æœå®¡æ‰¹é…ç½®å€¼ä¸º "required" â†’ next_requires_approval = true

5. å¦‚æœ next_requires_approval == falseï¼š
   a. æ›´æ–°çŠ¶æ€ï¼ˆæ‰§è¡Œå‰ï¼‰ï¼š
      - æ›´æ–° STATE.yaml: workflow.current_step = next_step
      - æ ¹æ®å·¥ä½œæµè½¬æ¢è¡¨ç¡®å®šæ–°çš„ next_step
      - æ›´æ–° STATE.yaml: workflow.next_step = æ–°å€¼
   b. æ‰§è¡Œå‘½ä»¤ï¼š
      - æ ¹æ®"æ­¥éª¤åç§°åˆ°å‘½ä»¤æ˜ å°„è¡¨"æ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤
      - å¦‚æœæ˜¯ `/split ticket`ï¼Œéœ€è¦ä» STATE.current_story è·å– Story ID
      - æ‰§è¡Œå‘½ä»¤ï¼ˆè°ƒç”¨å¯¹åº”çš„ Agent å’Œ Skillï¼‰
      - ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæˆ
   c. æ›´æ–°çŠ¶æ€ï¼ˆæ‰§è¡Œåï¼‰ï¼š
      - å¦‚æœå‘½ä»¤æˆåŠŸï¼Œæ›´æ–° workflow.current_step = æ–°çš„æ­¥éª¤å
      - å¦‚æœå‘½ä»¤å¤±è´¥ï¼Œåœæ­¢å¹¶è¾“å‡ºé”™è¯¯
   d. ç»§ç»­å¾ªç¯ï¼š
      - é‡å¤æ­¥éª¤ 1-5ï¼Œç›´åˆ°é‡åˆ°éœ€è¦å®¡æ‰¹çš„æ­¥éª¤æˆ–å·¥ä½œæµç»“æŸ

6. å¦‚æœ next_requires_approval == trueï¼š
   - è¾“å‡ºæ¸…æ™°çš„å®¡æ‰¹æç¤ºï¼š"ç­‰å¾…å®¡æ‰¹: /approve {å¯¹åº”çš„å®¡æ‰¹å‘½ä»¤}"
   - æ›´æ–° STATE.yaml: workflow.current_step = å½“å‰æ­¥éª¤
   - åœæ­¢å“åº”
```

#### æ­¥éª¤åç§°åˆ°å‘½ä»¤æ˜ å°„è¡¨

| æ­¥éª¤åç§° | å®é™…å‘½ä»¤ | å‚æ•°æ¥æº |
|----------|----------|----------|
| `split_story` | `/split story` | - |
| `approve_stories` | `/approve stories` | - |
| `split_ticket` | `/split ticket {story_id}` | STATE.current_story |
| `approve_tickets` | `/approve tickets` | - |
| `next` | `/next` | - |
| `verify` | `/verify {story_id}` | STATE.current_story |
| `approve_story` | `/approve {story_id}` | STATE.current_story |
| `next_story` | æ£€æŸ¥ä¸‹ä¸€ä¸ª Storyï¼ˆè§ä¸‹æ–¹é€»è¾‘ï¼‰ | STATE.stories |
| `null` | æ— ï¼ˆå·¥ä½œæµç»“æŸï¼‰ | - |

#### `next_story` åˆ†æ”¯é€»è¾‘

```
if å­˜åœ¨ pending Story:
    current_story = ä¸‹ä¸€ä¸ª pending Story ID
    current_step = "stories_approved"  # å›åˆ°æ‹† Ticket é˜¶æ®µ
    next_step = "split_ticket"
    æ‰§è¡Œ /split ticket {story_id}
else:
    current_step = "all_stories_done"
    next_step = null
    è¾“å‡º "æ‰€æœ‰ Stories å·²å®Œæˆ"
```

#### å‘½ä»¤åˆ°æ­¥éª¤åç§°æ˜ å°„è¡¨

| å‘½ä»¤ | å®Œæˆåçš„æ­¥éª¤åç§° | è¯´æ˜ |
|------|----------------|------|
| `/brainstorm` | `brainstorm_done` | éœ€æ±‚åˆ†æå®Œæˆ |
| `/split story` | `story_split_done` | Story æ‹†åˆ†å®Œæˆ |
| `/split ticket S-xxx` | `ticket_split_done` | Ticket æ‹†åˆ†å®Œæˆ |
| `/next` | `ticket_done` æˆ– `all_tickets_done` | Ticket æ‰§è¡Œå®Œæˆï¼ˆå¦‚æœæ˜¯æœ€åä¸€ä¸ªåˆ™ä¸º all_tickets_doneï¼‰ |
| `/verify S-xxx` | `story_done` | Story éªŒæ”¶å®Œæˆ |
| `/approve stories` | `stories_approved` | Stories å®¡æ‰¹é€šè¿‡ï¼ˆå¼€å§‹æ‹† Ticketsï¼‰ |
| `/approve tickets` | `ticket_approved` | Tickets å®¡æ‰¹é€šè¿‡ |
| `/approve S-xxx` | `story_approved` æˆ– `all_stories_done` | Story å®¡æ‰¹é€šè¿‡ï¼ˆå¦‚æœæ˜¯æœ€åä¸€ä¸ªåˆ™ä¸º all_stories_doneï¼‰ |

#### è¾¹ç•Œæƒ…å†µå¤„ç†

| æƒ…å†µ | å¤„ç†æ–¹å¼ |
|------|----------|
| workflow å­—æ®µä¸å­˜åœ¨ | åˆ›å»º workflow å­—æ®µï¼Œè®¾ç½® current_step = å½“å‰å‘½ä»¤å¯¹åº”çš„æ­¥éª¤å |
| next_step ä¸ºç©º | åœæ­¢ï¼Œè¾“å‡º"å·¥ä½œæµå·²å®Œæˆ" |
| å®¡æ‰¹é…ç½®é”®ä¸å­˜åœ¨ | è§†ä¸º "auto"ï¼Œè‡ªåŠ¨ç»§ç»­ |
| è½¬æ¢è¡¨ä¸­æ‰¾ä¸åˆ° next_step | åœæ­¢ï¼Œè¾“å‡º"æœªçŸ¥æ­¥éª¤: {next_step}" |
| split_ticket éœ€è¦ Story ID ä½†ä¸å­˜åœ¨ | åœæ­¢ï¼Œè¾“å‡º"éœ€è¦å…ˆé€‰æ‹© Story" |
| å‘½ä»¤æ‰§è¡Œå¤±è´¥ | ä¸æ›´æ–° workflowï¼Œåœæ­¢å¹¶è¾“å‡ºé”™è¯¯ |

#### ç¤ºä¾‹æµç¨‹

```
ç”¨æˆ·: /brainstorm æƒé™ç®¡ç†
AI: [æ‰§è¡Œ brainstorm]
    [å®Œæˆéœ€æ±‚æ–‡æ¡£]
    [æ›´æ–° workflow: current_step=brainstorm_done, next_step=split_story]
    [æ£€æŸ¥: split_story ä¸éœ€è¦å®¡æ‰¹]
    [è‡ªåŠ¨æ‰§è¡Œ split_story]
    [å®Œæˆ Stories æ‹†åˆ†]
    [æ›´æ–° workflow: current_step=story_split_done, next_step=approve_stories]
    [æ£€æŸ¥: approve_stories éœ€è¦å®¡æ‰¹ (config.approval.story_split=required)]
    [åœæ­¢]
è¾“å‡º: Stories å·²æ‹†åˆ†ï¼Œç­‰å¾…å®¡æ‰¹: /approve stories
```

#### é…ç½®è¯´æ˜

å®¡æ‰¹é…ç½®åœ¨ `config.yaml` ä¸­å®šä¹‰ï¼š

```yaml
approval:
  story_split: required      # Story æ‹†åˆ†åéœ€è¦å®¡æ‰¹
  ticket_split: required     # Ticket æ‹†åˆ†åéœ€è¦å®¡æ‰¹
  ticket_done: auto          # Ticket å®Œæˆåè‡ªåŠ¨ç»§ç»­
  story_done: required       # Story å®Œæˆéœ€è¦äººå·¥å®¡æ‰¹
```

å¦‚æœè®¾ç½®ä¸º `auto`ï¼Œåˆ™è‡ªåŠ¨ç»§ç»­ï¼›å¦‚æœè®¾ç½®ä¸º `required`ï¼Œåˆ™åœæ­¢ç­‰å¾…å®¡æ‰¹ã€‚

## å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| /init-project | åˆå§‹åŒ–é¡¹ç›® |
| /add-requirement | æ³¨å†Œéœ€æ±‚ |
| /brainstorm | å¤´è„‘é£æš´ |
| /split story | æ‹†è§£ Story |
| /split ticket S-xxx | æ‹†è§£ Ticket |
| /approve | å®¡æ‰¹ |
| /next | æ‰§è¡Œä¸‹ä¸€ä¸ª Ticket |
| /status | æŸ¥çœ‹è¿›åº¦ |
| /checkpoint | ä¿å­˜æ£€æŸ¥ç‚¹ |
| /save | checkpoint åˆ«å |
| /restore | æ¢å¤æ£€æŸ¥ç‚¹ |
| /rollback | å›æ»šå˜æ›´ |

## åŠ è½½é…ç½®

- æ ¸å¿ƒæ¡†æ¶: `.claude/`
- é¡¹ç›®é…ç½®: `.claude/project/config.yaml`
- å½“å‰çŠ¶æ€: `osg-spec-docs/tasks/STATE.yaml`

## å‘½ä»¤å®ç°

æ‰€æœ‰å‘½ä»¤å®šä¹‰åœ¨ `.claude/commands/` ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ `/xxx` æ—¶è¯»å–å¯¹åº”çš„ `.md` æ–‡ä»¶ã€‚
```

### å®é™…è§¦å‘æœºåˆ¶

ç”±äº Cursor ä¸ä¼šçœŸæ­£"è‡ªåŠ¨æ‰§è¡Œ"ï¼Œå®é™…è§¦å‘æ–¹å¼æ˜¯ï¼š

1. **ç”¨æˆ·æ‰“å¼€é¡¹ç›®** â†’ Cursor åŠ è½½ `.claude/CLAUDE.md`
2. **ç”¨æˆ·å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯** â†’ AI çœ‹åˆ° CLAUDE.md ä¸­çš„"ä¼šè¯å¯åŠ¨æŒ‡ä»¤"
3. **AI æ‰§è¡Œæ¢å¤æµç¨‹** â†’ è¯»å– STATE.yamlï¼Œè¾“å‡ºæ¢å¤æŠ¥å‘Š

**å…³é”®ç‚¹**ï¼šåœ¨ CLAUDE.md å¼€å¤´æ˜ç¡®å†™"æ¯æ¬¡ä¼šè¯å¼€å§‹æ—¶ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ­¥éª¤"ï¼ŒClaude ä¼šåœ¨çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚

---

## 14. æ ¸å¿ƒæ¨¡æ¿ç”Ÿæˆè¯´æ˜

### é—®é¢˜èƒŒæ™¯

`/init-project` å‘½ä»¤è¯´è¦"å¤åˆ¶æ ¸å¿ƒæ¡†æ¶æ–‡ä»¶"ï¼Œä½†è¿™äº›æ–‡ä»¶ä»å“ªé‡Œæ¥ï¼Ÿ

### è§£å†³æ–¹æ¡ˆ

æœ‰ä¸¤ç§æ–¹å¼ç”Ÿæˆæ ¸å¿ƒæ¡†æ¶æ–‡ä»¶ï¼š

#### æ–¹å¼ Aï¼šä»è®¾è®¡æ–‡æ¡£æ‰‹åŠ¨æå–ï¼ˆæ¨èï¼Œé¦–æ¬¡ä½¿ç”¨ï¼‰

æ ¹æ®ä»¥ä¸‹è®¾è®¡æ–‡æ¡£ï¼Œæ‰‹åŠ¨åˆ›å»ºå¯¹åº”çš„ SKILL.md å’Œ AGENT.md æ–‡ä»¶ï¼š

| è®¾è®¡æ–‡æ¡£ | ç”Ÿæˆçš„æ–‡ä»¶ |
|---------|-----------|
| `10_Skills_è®°å¿†ç®¡ç†.md` | `.claude/skills/memory-bank/SKILL.md` ç­‰ |
| `11_Skills_å·¥ä½œæµ.md` | `.claude/skills/brainstorming/SKILL.md` ç­‰ |
| `12_Skills_è´¨é‡.md` | `.claude/skills/verification/SKILL.md` ç­‰ |
| `13_Skills_è‡ªåŠ¨åŒ–.md` | `.claude/skills/ralph-loop/SKILL.md` ç­‰ |
| `20-25_Agent_*.md` | `.claude/agents/*.md` |
| `40_commands_å‘½ä»¤æ–‡ä»¶.md` | `.claude/commands/*.md` |
| `41_templates_æ¨¡æ¿æ–‡ä»¶.md` | `.claude/templates/*.yaml` |

**æå–è§„åˆ™**ï¼š
1. æ¯ä¸ª Skill çš„"Prompt æ¨¡æ¿"éƒ¨åˆ† â†’ å¯¹åº”çš„ `SKILL.md` æ–‡ä»¶
2. æ¯ä¸ª Agent çš„"ç³»ç»Ÿæç¤ºè¯"éƒ¨åˆ† â†’ å¯¹åº”çš„ `AGENT.md` æ–‡ä»¶
3. æ¯ä¸ªå‘½ä»¤çš„è¯¦ç»†è¯´æ˜ â†’ å¯¹åº”çš„å‘½ä»¤ `.md` æ–‡ä»¶

#### æ–¹å¼ Bï¼šä½¿ç”¨ç”Ÿæˆè„šæœ¬ï¼ˆè‡ªåŠ¨åŒ–ï¼‰

åˆ›å»º `scripts/generate-framework.sh`ï¼š

```bash
#!/bin/bash
# ä»è®¾è®¡æ–‡æ¡£ç”Ÿæˆæ¡†æ¶æ–‡ä»¶çš„è„šæœ¬

DESIGN_DIR="docs/ä¸€äººå…¬å¸æ¡†æ¶"
OUTPUT_DIR=".claude"

# 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p $OUTPUT_DIR/skills/{memory-bank,context-compression,checkpoint-manager,...}
mkdir -p $OUTPUT_DIR/agents
mkdir -p $OUTPUT_DIR/templates
mkdir -p $OUTPUT_DIR/project/agents
mkdir -p $OUTPUT_DIR/project/rules
mkdir -p $OUTPUT_DIR/commands

# 2. æå– Skill å†…å®¹ï¼ˆéœ€è¦ AI è¾…åŠ©æˆ–æ‰‹åŠ¨ï¼‰
# ä» 10_Skills_è®°å¿†ç®¡ç†.md ç­‰æ–‡ä»¶ä¸­æå– Prompt æ¨¡æ¿éƒ¨åˆ†

# 3. æå– Agent å†…å®¹
# ä» 20-25_Agent_*.md æ–‡ä»¶ä¸­æå–ç³»ç»Ÿæç¤ºè¯éƒ¨åˆ†

# 4. æå–å‘½ä»¤å†…å®¹
# ä» 40_commands_å‘½ä»¤æ–‡ä»¶.md ä¸­æå–å„å‘½ä»¤çš„ markdown å†…å®¹

echo "æ¡†æ¶æ–‡ä»¶ç”Ÿæˆå®Œæˆï¼Œè¯·æ£€æŸ¥ $OUTPUT_DIR/"
```

**æ³¨æ„**ï¼šç”±äºè®¾è®¡æ–‡æ¡£æ˜¯ Markdown æ ¼å¼çš„äººç±»å¯è¯»æ–‡æ¡£ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–æå–æœ‰éš¾åº¦ã€‚æ¨èæ–¹å¼æ˜¯ï¼š
1. é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œè®© AIï¼ˆå¦‚ Claudeï¼‰è¯»å–è®¾è®¡æ–‡æ¡£å¹¶ç”Ÿæˆ `.claude/` ç›®å½•ä¸‹çš„æ–‡ä»¶
2. åç»­é¡¹ç›®å¤åˆ¶å·²ç”Ÿæˆçš„æ¡†æ¶æ–‡ä»¶

---

## 15. å¹³å°é€‚é…å±‚è¯´æ˜

### æ–°å¢çš„å¹³å°é€‚é… Skills

| Skill | ä½œç”¨ | æ–‡æ¡£ä½ç½® |
|-------|------|---------|
| `subagent-dispatch` | è‡ªåŠ¨æ£€æµ‹å¹³å°ï¼Œä½¿ç”¨æœ€ä½³çš„å­ä»£ç†è°ƒç”¨æ–¹å¼ | [45_å¹³å°é€‚é…ä¸Hooksæœºåˆ¶](45_å¹³å°é€‚é…ä¸Hooksæœºåˆ¶.md) |
| `hooks-manager` | ç®¡ç†æ¡†æ¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆSessionStart ç­‰ï¼‰ | [45_å¹³å°é€‚é…ä¸Hooksæœºåˆ¶](45_å¹³å°é€‚é…ä¸Hooksæœºåˆ¶.md) |

### å¹³å°é€‚é…å±‚ç›®å½•ç»“æ„

```
.claude/platform/
â”œâ”€â”€ interface.yaml       # ç»Ÿä¸€æ¥å£å®šä¹‰
â”œâ”€â”€ cursor/              # Cursor IDE é€‚é…
â”‚   â”œâ”€â”€ subagent.md      # Prompt æ¨¡æ‹Ÿå­ä»£ç†
â”‚   â””â”€â”€ hooks.md         # é¦–æ¬¡å“åº”è‡ªæ£€
â”œâ”€â”€ claude-cli/          # Claude Code CLI é€‚é…
â”‚   â”œâ”€â”€ subagent.md      # åŸç”Ÿ Subagent
â”‚   â””â”€â”€ hooks.md         # hooks.json é…ç½®
â””â”€â”€ mcp/                 # MCP Server é€‚é…
    â”œâ”€â”€ subagent.md      # MCP å·¥å…·è°ƒç”¨
    â””â”€â”€ hooks.md         # MCP é€šçŸ¥æœºåˆ¶
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

**æ¡†æ¶æ ¸å¿ƒå±‚ä¸å¹³å°å®ç°åˆ†ç¦»**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ¡†æ¶æ ¸å¿ƒå±‚ï¼ˆä¸å˜ï¼‰       â”‚  â† Skills + Agents + RPIV å·¥ä½œæµ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å¹³å°é€‚é…å±‚ (PAL)        â”‚  â† å­ä»£ç†æ¥å£ + Hooks æ¥å£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚Cursor â”‚Claude â”‚ MCP   â”‚å…¶ä»– â”‚  â† å…·ä½“å¹³å°å®ç°
â”‚ IDE   â”‚ CLI   â”‚Server â”‚å¹³å° â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

è¯¦è§ [45_å¹³å°é€‚é…ä¸Hooksæœºåˆ¶](45_å¹³å°é€‚é…ä¸Hooksæœºåˆ¶.md)

---

## ç›¸å…³æ–‡æ¡£

- [00_æ¦‚è§ˆ](00_æ¦‚è§ˆ.md) - è¿”å›æ¦‚è§ˆ
- [40_commands_å‘½ä»¤æ–‡ä»¶](40_commands_å‘½ä»¤æ–‡ä»¶.md) - å‘½ä»¤æ–‡ä»¶è¯¦æƒ…
- [41_templates_æ¨¡æ¿æ–‡ä»¶](41_templates_æ¨¡æ¿æ–‡ä»¶.md) - æ¨¡æ¿æ–‡ä»¶è¯¦æƒ…
- [45_å¹³å°é€‚é…ä¸Hooksæœºåˆ¶](45_å¹³å°é€‚é…ä¸Hooksæœºåˆ¶.md) - è·¨å¹³å°æ”¯æŒ