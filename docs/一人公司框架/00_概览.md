# 一人公司 AI 交付框架 - 概览

> 基于 obra/superpowers、Ralph Loop、Catalyst、TÂCHES、LangGraph 等业界最佳实践，独立实现一套 Skills + Agents 结合的工程化交付框架。

## 文档导航

| 编号 | 文档 | 内容 |
|------|------|------|
| 00 | **概览**（本文档） | 架构概述、核心原则、快速入门 |
| 01 | [工作流_RPIV](01_工作流_RPIV.md) | RPIV 四阶段、审批点、会话恢复 |
| 02 | [错误处理](02_错误处理.md) | 错误分类、回滚机制、Agent 信息传递 |
| 10 | [Skills_记忆管理](10_Skills_记忆管理.md) | memory-bank, context-compression, checkpoint-manager |
| 11 | [Skills_工作流](11_Skills_工作流.md) | brainstorming, story-splitter, ticket-splitter, deliver-ticket |
| 12 | [Skills_质量](12_Skills_质量.md) | verification, tdd, code-review, debugging |
| 13 | [Skills_自动化](13_Skills_自动化.md) | ralph-loop, progress-tracker |
| 20 | [Agent_Coordinator](20_Agent_Coordinator.md) | 协调员 |
| 21 | [Agent_Architect](21_Agent_Architect.md) | 架构师 |
| 22 | [Agent_Planner](22_Agent_Planner.md) | 计划员 |
| 23 | [Agent_Developer](23_Agent_Developer.md) | 开发者 |
| 24 | [Agent_Reviewer](24_Agent_Reviewer.md) | 评审员 |
| 25 | [Agent_QA](25_Agent_QA.md) | QA |
| 30 | [格式规范](30_格式规范.md) | Ticket、Story、日志 YAML 格式 |
| 31 | [项目配置](31_项目配置.md) | config.yaml、目录结构、初始化流程 |
| 32 | [命令体系](32_命令体系.md) | 所有 /xxx 命令说明 |
| 40 | [commands_命令文件](40_commands_命令文件.md) | 9 个命令文件的具体内容 |
| 41 | [templates_模板文件](41_templates_模板文件.md) | 5 个 YAML 模板文件 |
| 42 | [实现细节](42_实现细节.md) | Subagent、上下文检测、Git 集成 |
| 43 | [rules_代码规范](43_rules_代码规范.md) | Java、Vue、SQL 代码规范 |

---

## 参考来源

| 来源 | Stars | 借鉴内容 |
|------|-------|----------|
| [obra/superpowers](https://github.com/obra/superpowers) | 40k+ | 核心工作流、微任务拆解、证据先于断言 |
| [Ralph Loop](https://github.com/thecgaigroup/ralph-cc-loop) | - | 自主循环执行、完成承诺机制 |
| [Catalyst](https://github.com/coalesce-labs/catalyst) | - | RPIV 工作流、持久化记忆 |
| [TÂCHES](https://github.com/glittercowboy/taches-cc-resources) | 1.2k | Meta-skills、39 skills + 11 agents 架构 |
| [Context Engineering Kit](https://github.com/NeoLabHQ/context-engineering-kit) | 302 | 上下文工程优化 |
| [LangGraph](https://github.com/langchain-ai/langgraph) | - | 生产级 6 要素、状态机设计 |
| [claude-memory-bank](https://github.com/russbeye/claude-memory-bank) | - | 工作追踪、跨会话持久化 |
| ACON/ReSum/CaT 论文 | - | 上下文压缩技术（节省 26-54% token） |

---

## 核心设计原则

1. **Skills + Agents 结合**：Skills 定义"怎么做"，Agents 定义"谁来做"
2. **通用层 + 项目层分离**：通用框架可复用，项目配置可定制
3. **RPIV 工作流**：Research → Plan → Implement → Validate
4. **记忆管理**：工作记忆 + 长期记忆 + 上下文压缩
5. **检查点恢复**：支持长时任务的状态保存和恢复
6. **自主循环**：Ralph Loop 模式，持续执行直到完成
7. **多端并行**：Git Worktree 支持多 Agent 并行开发
8. **人工制定 + 机器执行**：拆解阶段人工参与，执行阶段全自动
9. **微任务拆解**：每个 Ticket 2-5 分钟可完成
10. **证据先于断言**：所有完成声明必须有命令输出证明

---

## Skills vs Agents

| 概念 | 类比 | 作用 | 位置 |
|------|------|------|------|
| **Skill** | 岗位职责手册 | 定义"怎么做"：规则、步骤、约束 | `core/skills/` |
| **Agent** | 员工 | 定义"谁来做"：角色、工具、加载哪些 Skills | `core/agents/` + `project/agents/` |

**关系**：Agent 通过 `skills:` 字段加载对应的 Skills，然后执行任务。

**Agent 配置格式**（Claude Code 官方规范）：

```yaml
---
name: agent-name
description: 什么时候调用这个 agent
tools: Read, Grep, Write, Bash    # 可用工具
skills: skill1, skill2            # 预加载的 skills
---
系统提示词...
```

---

## 分层架构

```
┌─────────────────────────────────────────────────────────┐
│  Core Layer（核心层 - 不变，可复用到任何项目）            │
│  ├── 工作流程（RPIV: Research → Plan → Implement → Validate）│
│  ├── 角色模板（Coordinator, Architect, Planner, Developer...）│
│  ├── 核心 Skills（13 个，分 4 类）                       │
│  ├── 记忆管理机制                                        │
│  ├── 错误处理机制                                        │
│  └── 状态管理、检查点机制                                │
└─────────────────────────────────────────────────────────┘
                            ↓ 继承/配置
┌─────────────────────────────────────────────────────────┐
│  Project Layer（项目层 - 可变，项目特定）                 │
│  ├── 技术栈配置（Java/Python/Go/Vue/React...）          │
│  ├── 开发者角色实例（backend-java, frontend-vue...）    │
│  ├── 代码规范（rules/）- 可引用外部规范                  │
│  └── 命令映射（test → mvn test / pytest...）           │
└─────────────────────────────────────────────────────────┘
```

---

## 角色体系总览

```mermaid
flowchart TD
    subgraph meta [元层 - 协调]
        Coord[Coordinator<br/>协调员]
    end
    
    subgraph planning [规划层]
        Arch[Architect<br/>架构师]
        Plan[Planner<br/>计划员]
    end
    
    subgraph development [开发层 - 按端细分]
        BE[Backend Developer<br/>后端开发]
        FE[Frontend Developer<br/>前端开发]
        DBA[DBA<br/>数据库]
    end
    
    subgraph quality [质量层]
        Rev[Reviewer<br/>代码评审]
        QA[QA<br/>测试验收]
    end
    
    Coord --> Arch
    Coord --> Plan
    Arch --> Plan
    Plan --> BE
    Plan --> FE
    Plan --> DBA
    BE --> Rev
    FE --> Rev
    DBA --> Rev
    Rev --> QA
    QA -->|不通过| BE
    QA -->|不通过| FE
```

| 层级 | 角色 | 加载的 Skills | 说明 |
|------|------|---------------|------|
| **元层** | Coordinator | progress-tracker, memory-bank | 协调多 Agent、追踪进度 |
| **规划层** | Architect | brainstorming, context-compression | 方案设计、架构探索 |
| | Planner | story-splitter, ticket-splitter | 需求拆解、任务规划 |
| **开发层** | Backend Developer | deliver-ticket, tdd, checkpoint-manager | 后端代码实现 |
| | Frontend Developer | deliver-ticket, checkpoint-manager | 前端代码实现 |
| | DBA | deliver-ticket | 数据库变更 |
| **质量层** | Reviewer | code-review | 代码评审 |
| | QA | verification | 测试验收 |

---

## Skills 分类总览

| 类别 | Skills | 数量 |
|------|--------|------|
| **记忆管理** | memory-bank, context-compression, checkpoint-manager | 3 |
| **工作流** | brainstorming, story-splitter, ticket-splitter, deliver-ticket | 4 |
| **质量** | verification, tdd, code-review, debugging | 4 |
| **自动化** | ralph-loop, progress-tracker | 2 |
| **总计** | | **13** |

---

## 目录结构

```
.claude/
├── core/                        # 【不变】核心框架
│   ├── skills/                  # 核心技能（13 个）
│   │   ├── memory-bank/
│   │   ├── context-compression/
│   │   ├── checkpoint-manager/
│   │   ├── ralph-loop/
│   │   ├── progress-tracker/
│   │   ├── brainstorming/
│   │   ├── story-splitter/
│   │   ├── ticket-splitter/
│   │   ├── deliver-ticket/
│   │   ├── verification/
│   │   ├── tdd/
│   │   ├── code-review/
│   │   └── debugging/
│   ├── agents/                  # 角色模板（7 个）
│   └── templates/               # 文件模板
│
├── project/                     # 【可变】项目配置
│   ├── config.yaml              # 项目配置
│   ├── agents/                  # 项目角色实例
│   └── rules/                   # 项目代码规范
│
├── memory/                      # 持久化记忆
├── checkpoints/                 # 检查点
├── CLAUDE.md                    # 项目入口
└── commands/                    # 快捷命令

tasks/                           # 任务管理
├── STATE.yaml                   # 全局状态
├── stories/
└── tickets/

workspace/logs/                  # 执行日志
artifacts/reviews/               # 评审记录
docs/requirements/               # 需求文档
```

---

## 快速入门

### 1. 初始化项目

```bash
/init-project ruoyi-vue --stack java,vue,mysql
```

### 2. 放置需求文档

将需求放到 `docs/requirements/REQ-001.md`

### 3. 执行工作流

```bash
/brainstorm              # 头脑风暴，细化需求
/split story             # 拆解为 Stories
/approve stories         # 审批 Stories
/split ticket S-001      # 拆解为 Tickets
/approve tickets         # 审批 Tickets
/next                    # 执行下一个 Ticket
/status                  # 查看进度
```

### 4. 恢复会话

新会话开始时，框架会自动：
1. 加载 `tasks/STATE.yaml`
2. 读取 `memory/decisions.yaml`
3. 输出状态报告
4. 提示继续执行

---

## 下一步阅读

- 了解工作流程：[01_工作流_RPIV.md](01_工作流_RPIV.md)
- 了解错误处理：[02_错误处理.md](02_错误处理.md)
- 了解 Skills 详情：[10_Skills_记忆管理.md](10_Skills_记忆管理.md)
